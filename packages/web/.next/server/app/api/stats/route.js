/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/stats/route";
exports.ids = ["app/api/stats/route"];
exports.modules = {

/***/ "(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fstats%2Froute&page=%2Fapi%2Fstats%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstats%2Froute.ts&appDir=%2FUsers%2Fsheirraza%2Fakhai%2Fpackages%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fsheirraza%2Fakhai%2Fpackages%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fstats%2Froute&page=%2Fapi%2Fstats%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstats%2Froute.ts&appDir=%2FUsers%2Fsheirraza%2Fakhai%2Fpackages%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fsheirraza%2Fakhai%2Fpackages%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   handler: () => (/* binding */ handler),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/dist/server/request-meta */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/request-meta.js\");\n/* harmony import */ var next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! next/dist/server/lib/trace/tracer */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/lib/trace/tracer.js\");\n/* harmony import */ var next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! next/dist/shared/lib/router/utils/app-paths */ \"next/dist/shared/lib/router/utils/app-paths\");\n/* harmony import */ var next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__);\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! next/dist/server/base-http/node */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/base-http/node.js\");\n/* harmony import */ var next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__);\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! next/dist/server/web/spec-extension/adapters/next-request */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/web/spec-extension/adapters/next-request.js\");\n/* harmony import */ var next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__);\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! next/dist/server/lib/trace/constants */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/lib/trace/constants.js\");\n/* harmony import */ var next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__);\n/* harmony import */ var next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/dist/server/instrumentation/utils */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/instrumentation/utils.js\");\n/* harmony import */ var next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! next/dist/server/send-response */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/send-response.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! next/dist/server/web/utils */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/web/utils.js\");\n/* harmony import */ var next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__);\n/* harmony import */ var next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! next/dist/server/lib/cache-control */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/lib/cache-control.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__ = __webpack_require__(/*! next/dist/lib/constants */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/lib/constants.js\");\n/* harmony import */ var next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13___default = /*#__PURE__*/__webpack_require__.n(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__);\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__ = __webpack_require__(/*! next/dist/shared/lib/no-fallback-error.external */ \"next/dist/shared/lib/no-fallback-error.external\");\n/* harmony import */ var next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14___default = /*#__PURE__*/__webpack_require__.n(next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__);\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__ = __webpack_require__(/*! next/dist/server/response-cache */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/server/response-cache/index.js\");\n/* harmony import */ var next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__);\n/* harmony import */ var _Users_sheirraza_akhai_packages_web_app_api_stats_route_ts__WEBPACK_IMPORTED_MODULE_16__ = __webpack_require__(/*! ./app/api/stats/route.ts */ \"(rsc)/./app/api/stats/route.ts\");\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/stats/route\",\n        pathname: \"/api/stats\",\n        filename: \"route\",\n        bundlePath: \"app/api/stats/route\"\n    },\n    distDir: \".next\" || 0,\n    relativeProjectDir:  false || '',\n    resolvedPagePath: \"/Users/sheirraza/akhai/packages/web/app/api/stats/route.ts\",\n    nextConfigOutput,\n    userland: _Users_sheirraza_akhai_packages_web_app_api_stats_route_ts__WEBPACK_IMPORTED_MODULE_16__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\nasync function handler(req, res, ctx) {\n    var _nextConfig_experimental;\n    let srcPage = \"/api/stats/route\";\n    // turbopack doesn't normalize `/index` in the page name\n    // so we need to to process dynamic routes properly\n    // TODO: fix turbopack providing differing value from webpack\n    if (false) {} else if (srcPage === '/index') {\n        // we always normalize /index specifically\n        srcPage = '/';\n    }\n    const multiZoneDraftMode = false;\n    const prepareResult = await routeModule.prepare(req, res, {\n        srcPage,\n        multiZoneDraftMode\n    });\n    if (!prepareResult) {\n        res.statusCode = 400;\n        res.end('Bad Request');\n        ctx.waitUntil == null ? void 0 : ctx.waitUntil.call(ctx, Promise.resolve());\n        return null;\n    }\n    const { buildId, params, nextConfig, isDraftMode, prerenderManifest, routerServerContext, isOnDemandRevalidate, revalidateOnlyGenerated, resolvedPathname } = prepareResult;\n    const normalizedSrcPage = (0,next_dist_shared_lib_router_utils_app_paths__WEBPACK_IMPORTED_MODULE_5__.normalizeAppPath)(srcPage);\n    let isIsr = Boolean(prerenderManifest.dynamicRoutes[normalizedSrcPage] || prerenderManifest.routes[resolvedPathname]);\n    if (isIsr && !isDraftMode) {\n        const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname]);\n        const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage];\n        if (prerenderInfo) {\n            if (prerenderInfo.fallback === false && !isPrerendered) {\n                throw new next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError();\n            }\n        }\n    }\n    let cacheKey = null;\n    if (isIsr && !routeModule.isDev && !isDraftMode) {\n        cacheKey = resolvedPathname;\n        // ensure /index and / is normalized to one key\n        cacheKey = cacheKey === '/index' ? '/' : cacheKey;\n    }\n    const supportsDynamicResponse = // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true || // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr;\n    // This is a revalidation request if the request is for a static\n    // page and it is not being resumed from a postponed render and\n    // it is not a dynamic RSC request then it is a revalidation\n    // request.\n    const isRevalidate = isIsr && !supportsDynamicResponse;\n    const method = req.method || 'GET';\n    const tracer = (0,next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.getTracer)();\n    const activeSpan = tracer.getActiveScopeSpan();\n    const context = {\n        params,\n        prerenderManifest,\n        renderOpts: {\n            experimental: {\n                cacheComponents: Boolean(nextConfig.experimental.cacheComponents),\n                authInterrupts: Boolean(nextConfig.experimental.authInterrupts)\n            },\n            supportsDynamicResponse,\n            incrementalCache: (0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'incrementalCache'),\n            cacheLifeProfiles: (_nextConfig_experimental = nextConfig.experimental) == null ? void 0 : _nextConfig_experimental.cacheLife,\n            isRevalidate,\n            waitUntil: ctx.waitUntil,\n            onClose: (cb)=>{\n                res.on('close', cb);\n            },\n            onAfterTaskError: undefined,\n            onInstrumentationRequestError: (error, _request, errorContext)=>routeModule.onRequestError(req, error, errorContext, routerServerContext)\n        },\n        sharedContext: {\n            buildId\n        }\n    };\n    const nodeNextReq = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextRequest(req);\n    const nodeNextRes = new next_dist_server_base_http_node__WEBPACK_IMPORTED_MODULE_6__.NodeNextResponse(res);\n    const nextReq = next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.NextRequestAdapter.fromNodeNextRequest(nodeNextReq, (0,next_dist_server_web_spec_extension_adapters_next_request__WEBPACK_IMPORTED_MODULE_7__.signalFromNodeResponse)(res));\n    try {\n        const invokeRouteModule = async (span)=>{\n            return routeModule.handle(nextReq, context).finally(()=>{\n                if (!span) return;\n                span.setAttributes({\n                    'http.status_code': res.statusCode,\n                    'next.rsc': false\n                });\n                const rootSpanAttributes = tracer.getRootSpanAttributes();\n                // We were unable to get attributes, probably OTEL is not enabled\n                if (!rootSpanAttributes) {\n                    return;\n                }\n                if (rootSpanAttributes.get('next.span_type') !== next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest) {\n                    console.warn(`Unexpected root span type '${rootSpanAttributes.get('next.span_type')}'. Please report this Next.js issue https://github.com/vercel/next.js`);\n                    return;\n                }\n                const route = rootSpanAttributes.get('next.route');\n                if (route) {\n                    const name = `${method} ${route}`;\n                    span.setAttributes({\n                        'next.route': route,\n                        'http.route': route,\n                        'next.span_name': name\n                    });\n                    span.updateName(name);\n                } else {\n                    span.updateName(`${method} ${req.url}`);\n                }\n            });\n        };\n        const handleResponse = async (currentSpan)=>{\n            var _cacheEntry_value;\n            const responseGenerator = async ({ previousCacheEntry })=>{\n                try {\n                    if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isOnDemandRevalidate && revalidateOnlyGenerated && !previousCacheEntry) {\n                        res.statusCode = 404;\n                        // on-demand revalidate always sets this header\n                        res.setHeader('x-nextjs-cache', 'REVALIDATED');\n                        res.end('This page could not be found');\n                        return null;\n                    }\n                    const response = await invokeRouteModule(currentSpan);\n                    req.fetchMetrics = context.renderOpts.fetchMetrics;\n                    let pendingWaitUntil = context.renderOpts.pendingWaitUntil;\n                    // Attempt using provided waitUntil if available\n                    // if it's not we fallback to sendResponse's handling\n                    if (pendingWaitUntil) {\n                        if (ctx.waitUntil) {\n                            ctx.waitUntil(pendingWaitUntil);\n                            pendingWaitUntil = undefined;\n                        }\n                    }\n                    const cacheTags = context.renderOpts.collectedTags;\n                    // If the request is for a static response, we can cache it so long\n                    // as it's not edge.\n                    if (isIsr) {\n                        const blob = await response.blob();\n                        // Copy the headers from the response.\n                        const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.toNodeOutgoingHttpHeaders)(response.headers);\n                        if (cacheTags) {\n                            headers[next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER] = cacheTags;\n                        }\n                        if (!headers['content-type'] && blob.type) {\n                            headers['content-type'] = blob.type;\n                        }\n                        const revalidate = typeof context.renderOpts.collectedRevalidate === 'undefined' || context.renderOpts.collectedRevalidate >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? false : context.renderOpts.collectedRevalidate;\n                        const expire = typeof context.renderOpts.collectedExpire === 'undefined' || context.renderOpts.collectedExpire >= next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.INFINITE_CACHE ? undefined : context.renderOpts.collectedExpire;\n                        // Create the cache entry for the response.\n                        const cacheEntry = {\n                            value: {\n                                kind: next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE,\n                                status: response.status,\n                                body: Buffer.from(await blob.arrayBuffer()),\n                                headers\n                            },\n                            cacheControl: {\n                                revalidate,\n                                expire\n                            }\n                        };\n                        return cacheEntry;\n                    } else {\n                        // send response without caching if not ISR\n                        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, response, context.renderOpts.pendingWaitUntil);\n                        return null;\n                    }\n                } catch (err) {\n                    // if this is a background revalidate we need to report\n                    // the request error here as it won't be bubbled\n                    if (previousCacheEntry == null ? void 0 : previousCacheEntry.isStale) {\n                        await routeModule.onRequestError(req, err, {\n                            routerKind: 'App Router',\n                            routePath: srcPage,\n                            routeType: 'route',\n                            revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                                isRevalidate,\n                                isOnDemandRevalidate\n                            })\n                        }, routerServerContext);\n                    }\n                    throw err;\n                }\n            };\n            const cacheEntry = await routeModule.handleResponse({\n                req,\n                nextConfig,\n                cacheKey,\n                routeKind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n                isFallback: false,\n                prerenderManifest,\n                isRoutePPREnabled: false,\n                isOnDemandRevalidate,\n                revalidateOnlyGenerated,\n                responseGenerator,\n                waitUntil: ctx.waitUntil\n            });\n            // we don't create a cacheEntry for ISR\n            if (!isIsr) {\n                return null;\n            }\n            if ((cacheEntry == null ? void 0 : (_cacheEntry_value = cacheEntry.value) == null ? void 0 : _cacheEntry_value.kind) !== next_dist_server_response_cache__WEBPACK_IMPORTED_MODULE_15__.CachedRouteKind.APP_ROUTE) {\n                var _cacheEntry_value1;\n                throw Object.defineProperty(new Error(`Invariant: app-route received invalid cache entry ${cacheEntry == null ? void 0 : (_cacheEntry_value1 = cacheEntry.value) == null ? void 0 : _cacheEntry_value1.kind}`), \"__NEXT_ERROR_CODE\", {\n                    value: \"E701\",\n                    enumerable: false,\n                    configurable: true\n                });\n            }\n            if (!(0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode')) {\n                res.setHeader('x-nextjs-cache', isOnDemandRevalidate ? 'REVALIDATED' : cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT');\n            }\n            // Draft mode should never be cached\n            if (isDraftMode) {\n                res.setHeader('Cache-Control', 'private, no-cache, no-store, max-age=0, must-revalidate');\n            }\n            const headers = (0,next_dist_server_web_utils__WEBPACK_IMPORTED_MODULE_11__.fromNodeOutgoingHttpHeaders)(cacheEntry.value.headers);\n            if (!((0,next_dist_server_request_meta__WEBPACK_IMPORTED_MODULE_3__.getRequestMeta)(req, 'minimalMode') && isIsr)) {\n                headers.delete(next_dist_lib_constants__WEBPACK_IMPORTED_MODULE_13__.NEXT_CACHE_TAGS_HEADER);\n            }\n            // If cache control is already set on the response we don't\n            // override it to allow users to customize it via next.config\n            if (cacheEntry.cacheControl && !res.getHeader('Cache-Control') && !headers.get('Cache-Control')) {\n                headers.set('Cache-Control', (0,next_dist_server_lib_cache_control__WEBPACK_IMPORTED_MODULE_12__.getCacheControlHeader)(cacheEntry.cacheControl));\n            }\n            await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(cacheEntry.value.body, {\n                headers,\n                status: cacheEntry.value.status || 200\n            }));\n            return null;\n        };\n        // TODO: activeSpan code path is for when wrapped by\n        // next-server can be removed when this is no longer used\n        if (activeSpan) {\n            await handleResponse(activeSpan);\n        } else {\n            await tracer.withPropagatedContext(req.headers, ()=>tracer.trace(next_dist_server_lib_trace_constants__WEBPACK_IMPORTED_MODULE_8__.BaseServerSpan.handleRequest, {\n                    spanName: `${method} ${req.url}`,\n                    kind: next_dist_server_lib_trace_tracer__WEBPACK_IMPORTED_MODULE_4__.SpanKind.SERVER,\n                    attributes: {\n                        'http.method': method,\n                        'http.target': req.url\n                    }\n                }, handleResponse));\n        }\n    } catch (err) {\n        if (!(err instanceof next_dist_shared_lib_no_fallback_error_external__WEBPACK_IMPORTED_MODULE_14__.NoFallbackError)) {\n            await routeModule.onRequestError(req, err, {\n                routerKind: 'App Router',\n                routePath: normalizedSrcPage,\n                routeType: 'route',\n                revalidateReason: (0,next_dist_server_instrumentation_utils__WEBPACK_IMPORTED_MODULE_9__.getRevalidateReason)({\n                    isRevalidate,\n                    isOnDemandRevalidate\n                })\n            });\n        }\n        // rethrow so that we can handle serving error page\n        // If this is during static generation, throw the error again.\n        if (isIsr) throw err;\n        // Otherwise, send a 500 response.\n        await (0,next_dist_server_send_response__WEBPACK_IMPORTED_MODULE_10__.sendResponse)(nodeNextReq, nodeNextRes, new Response(null, {\n            status: 500\n        }));\n        return null;\n    }\n}\n\n//# sourceMappingURL=app-route.js.map\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vLi4vbm9kZV9tb2R1bGVzLy5wbnBtL25leHRAMTUuNS45X3JlYWN0LWRvbUAxOS4yLjNfcmVhY3RAMTkuMi4zL25vZGVfbW9kdWxlcy9uZXh0L2Rpc3QvYnVpbGQvd2VicGFjay9sb2FkZXJzL25leHQtYXBwLWxvYWRlci9pbmRleC5qcz9uYW1lPWFwcCUyRmFwaSUyRnN0YXRzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZzdGF0cyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnN0YXRzJTJGcm91dGUudHMmYXBwRGlyPSUyRlVzZXJzJTJGc2hlaXJyYXphJTJGYWtoYWklMkZwYWNrYWdlcyUyRndlYiUyRmFwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9JTJGVXNlcnMlMkZzaGVpcnJhemElMkZha2hhaSUyRnBhY2thZ2VzJTJGd2ViJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEJmlzR2xvYmFsTm90Rm91bmRFbmFibGVkPSEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBK0Y7QUFDdkM7QUFDcUI7QUFDZDtBQUNTO0FBQ087QUFDSztBQUNtQztBQUNqRDtBQUNPO0FBQ2Y7QUFDc0M7QUFDekI7QUFDTTtBQUNDO0FBQ2hCO0FBQ3FCO0FBQ3ZGO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMLGFBQWEsT0FBb0MsSUFBSSxDQUFFO0FBQ3ZELHdCQUF3QixNQUF1QztB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Q0FBNkMsMEZBQXFCO0FBQ2xFO0FBQ0Esa0JBQWtCLDZFQUFZO0FBQzlCO0FBQ0E7QUFDQSxhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsVUFBVTtBQUNWLDZFQUE2RSxnRkFBYztBQUMzRixpQ0FBaUMsUUFBUSxFQUFFLFFBQVE7QUFDbkQsMEJBQTBCLHVFQUFRO0FBQ2xDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsaUJBQWlCO0FBQ2pCO0FBQ0EsTUFBTTtBQUNOLDZCQUE2Qiw2RkFBZTtBQUM1QztBQUNBO0FBQ0E7QUFDQTtBQUNBLGtDQUFrQywyRkFBbUI7QUFDckQ7QUFDQTtBQUNBLGlCQUFpQjtBQUNqQixhQUFhO0FBQ2I7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLGNBQWMsNkVBQVk7QUFDMUI7QUFDQSxTQUFTO0FBQ1Q7QUFDQTtBQUNBOztBQUVBIiwic291cmNlcyI6WyIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0IHsgZ2V0UmVxdWVzdE1ldGEgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yZXF1ZXN0LW1ldGFcIjtcbmltcG9ydCB7IGdldFRyYWNlciwgU3BhbktpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvdHJhY2UvdHJhY2VyXCI7XG5pbXBvcnQgeyBub3JtYWxpemVBcHBQYXRoIH0gZnJvbSBcIm5leHQvZGlzdC9zaGFyZWQvbGliL3JvdXRlci91dGlscy9hcHAtcGF0aHNcIjtcbmltcG9ydCB7IE5vZGVOZXh0UmVxdWVzdCwgTm9kZU5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Jhc2UtaHR0cC9ub2RlXCI7XG5pbXBvcnQgeyBOZXh0UmVxdWVzdEFkYXB0ZXIsIHNpZ25hbEZyb21Ob2RlUmVzcG9uc2UgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci93ZWIvc3BlYy1leHRlbnNpb24vYWRhcHRlcnMvbmV4dC1yZXF1ZXN0XCI7XG5pbXBvcnQgeyBCYXNlU2VydmVyU3BhbiB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi90cmFjZS9jb25zdGFudHNcIjtcbmltcG9ydCB7IGdldFJldmFsaWRhdGVSZWFzb24gfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9pbnN0cnVtZW50YXRpb24vdXRpbHNcIjtcbmltcG9ydCB7IHNlbmRSZXNwb25zZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3NlbmQtcmVzcG9uc2VcIjtcbmltcG9ydCB7IGZyb21Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycywgdG9Ob2RlT3V0Z29pbmdIdHRwSGVhZGVycyB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3dlYi91dGlsc1wiO1xuaW1wb3J0IHsgZ2V0Q2FjaGVDb250cm9sSGVhZGVyIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL2NhY2hlLWNvbnRyb2xcIjtcbmltcG9ydCB7IElORklOSVRFX0NBQ0hFLCBORVhUX0NBQ0hFX1RBR1NfSEVBREVSIH0gZnJvbSBcIm5leHQvZGlzdC9saWIvY29uc3RhbnRzXCI7XG5pbXBvcnQgeyBOb0ZhbGxiYWNrRXJyb3IgfSBmcm9tIFwibmV4dC9kaXN0L3NoYXJlZC9saWIvbm8tZmFsbGJhY2stZXJyb3IuZXh0ZXJuYWxcIjtcbmltcG9ydCB7IENhY2hlZFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3Jlc3BvbnNlLWNhY2hlXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiL1VzZXJzL3NoZWlycmF6YS9ha2hhaS9wYWNrYWdlcy93ZWIvYXBwL2FwaS9zdGF0cy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3RhdHMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9zdGF0c1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvc3RhdHMvcm91dGVcIlxuICAgIH0sXG4gICAgZGlzdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX0RJU1RfRElSIHx8ICcnLFxuICAgIHJlbGF0aXZlUHJvamVjdERpcjogcHJvY2Vzcy5lbnYuX19ORVhUX1JFTEFUSVZFX1BST0pFQ1RfRElSIHx8ICcnLFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL3NoZWlycmF6YS9ha2hhaS9wYWNrYWdlcy93ZWIvYXBwL2FwaS9zdGF0cy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHdvcmtBc3luY1N0b3JhZ2UsXG4gICAgICAgIHdvcmtVbml0QXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBwYXRjaEZldGNoLCAgfTtcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBoYW5kbGVyKHJlcSwgcmVzLCBjdHgpIHtcbiAgICB2YXIgX25leHRDb25maWdfZXhwZXJpbWVudGFsO1xuICAgIGxldCBzcmNQYWdlID0gXCIvYXBpL3N0YXRzL3JvdXRlXCI7XG4gICAgLy8gdHVyYm9wYWNrIGRvZXNuJ3Qgbm9ybWFsaXplIGAvaW5kZXhgIGluIHRoZSBwYWdlIG5hbWVcbiAgICAvLyBzbyB3ZSBuZWVkIHRvIHRvIHByb2Nlc3MgZHluYW1pYyByb3V0ZXMgcHJvcGVybHlcbiAgICAvLyBUT0RPOiBmaXggdHVyYm9wYWNrIHByb3ZpZGluZyBkaWZmZXJpbmcgdmFsdWUgZnJvbSB3ZWJwYWNrXG4gICAgaWYgKHByb2Nlc3MuZW52LlRVUkJPUEFDSykge1xuICAgICAgICBzcmNQYWdlID0gc3JjUGFnZS5yZXBsYWNlKC9cXC9pbmRleCQvLCAnJykgfHwgJy8nO1xuICAgIH0gZWxzZSBpZiAoc3JjUGFnZSA9PT0gJy9pbmRleCcpIHtcbiAgICAgICAgLy8gd2UgYWx3YXlzIG5vcm1hbGl6ZSAvaW5kZXggc3BlY2lmaWNhbGx5XG4gICAgICAgIHNyY1BhZ2UgPSAnLyc7XG4gICAgfVxuICAgIGNvbnN0IG11bHRpWm9uZURyYWZ0TW9kZSA9IHByb2Nlc3MuZW52Ll9fTkVYVF9NVUxUSV9aT05FX0RSQUZUX01PREU7XG4gICAgY29uc3QgcHJlcGFyZVJlc3VsdCA9IGF3YWl0IHJvdXRlTW9kdWxlLnByZXBhcmUocmVxLCByZXMsIHtcbiAgICAgICAgc3JjUGFnZSxcbiAgICAgICAgbXVsdGlab25lRHJhZnRNb2RlXG4gICAgfSk7XG4gICAgaWYgKCFwcmVwYXJlUmVzdWx0KSB7XG4gICAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwO1xuICAgICAgICByZXMuZW5kKCdCYWQgUmVxdWVzdCcpO1xuICAgICAgICBjdHgud2FpdFVudGlsID09IG51bGwgPyB2b2lkIDAgOiBjdHgud2FpdFVudGlsLmNhbGwoY3R4LCBQcm9taXNlLnJlc29sdmUoKSk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBjb25zdCB7IGJ1aWxkSWQsIHBhcmFtcywgbmV4dENvbmZpZywgaXNEcmFmdE1vZGUsIHByZXJlbmRlck1hbmlmZXN0LCByb3V0ZXJTZXJ2ZXJDb250ZXh0LCBpc09uRGVtYW5kUmV2YWxpZGF0ZSwgcmV2YWxpZGF0ZU9ubHlHZW5lcmF0ZWQsIHJlc29sdmVkUGF0aG5hbWUgfSA9IHByZXBhcmVSZXN1bHQ7XG4gICAgY29uc3Qgbm9ybWFsaXplZFNyY1BhZ2UgPSBub3JtYWxpemVBcHBQYXRoKHNyY1BhZ2UpO1xuICAgIGxldCBpc0lzciA9IEJvb2xlYW4ocHJlcmVuZGVyTWFuaWZlc3QuZHluYW1pY1JvdXRlc1tub3JtYWxpemVkU3JjUGFnZV0gfHwgcHJlcmVuZGVyTWFuaWZlc3Qucm91dGVzW3Jlc29sdmVkUGF0aG5hbWVdKTtcbiAgICBpZiAoaXNJc3IgJiYgIWlzRHJhZnRNb2RlKSB7XG4gICAgICAgIGNvbnN0IGlzUHJlcmVuZGVyZWQgPSBCb29sZWFuKHByZXJlbmRlck1hbmlmZXN0LnJvdXRlc1tyZXNvbHZlZFBhdGhuYW1lXSk7XG4gICAgICAgIGNvbnN0IHByZXJlbmRlckluZm8gPSBwcmVyZW5kZXJNYW5pZmVzdC5keW5hbWljUm91dGVzW25vcm1hbGl6ZWRTcmNQYWdlXTtcbiAgICAgICAgaWYgKHByZXJlbmRlckluZm8pIHtcbiAgICAgICAgICAgIGlmIChwcmVyZW5kZXJJbmZvLmZhbGxiYWNrID09PSBmYWxzZSAmJiAhaXNQcmVyZW5kZXJlZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBOb0ZhbGxiYWNrRXJyb3IoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBsZXQgY2FjaGVLZXkgPSBudWxsO1xuICAgIGlmIChpc0lzciAmJiAhcm91dGVNb2R1bGUuaXNEZXYgJiYgIWlzRHJhZnRNb2RlKSB7XG4gICAgICAgIGNhY2hlS2V5ID0gcmVzb2x2ZWRQYXRobmFtZTtcbiAgICAgICAgLy8gZW5zdXJlIC9pbmRleCBhbmQgLyBpcyBub3JtYWxpemVkIHRvIG9uZSBrZXlcbiAgICAgICAgY2FjaGVLZXkgPSBjYWNoZUtleSA9PT0gJy9pbmRleCcgPyAnLycgOiBjYWNoZUtleTtcbiAgICB9XG4gICAgY29uc3Qgc3VwcG9ydHNEeW5hbWljUmVzcG9uc2UgPSAvLyBJZiB3ZSdyZSBpbiBkZXZlbG9wbWVudCwgd2UgYWx3YXlzIHN1cHBvcnQgZHluYW1pYyBIVE1MXG4gICAgcm91dGVNb2R1bGUuaXNEZXYgPT09IHRydWUgfHwgLy8gSWYgdGhpcyBpcyBub3QgU1NHIG9yIGRvZXMgbm90IGhhdmUgc3RhdGljIHBhdGhzLCB0aGVuIGl0IHN1cHBvcnRzXG4gICAgLy8gZHluYW1pYyBIVE1MLlxuICAgICFpc0lzcjtcbiAgICAvLyBUaGlzIGlzIGEgcmV2YWxpZGF0aW9uIHJlcXVlc3QgaWYgdGhlIHJlcXVlc3QgaXMgZm9yIGEgc3RhdGljXG4gICAgLy8gcGFnZSBhbmQgaXQgaXMgbm90IGJlaW5nIHJlc3VtZWQgZnJvbSBhIHBvc3Rwb25lZCByZW5kZXIgYW5kXG4gICAgLy8gaXQgaXMgbm90IGEgZHluYW1pYyBSU0MgcmVxdWVzdCB0aGVuIGl0IGlzIGEgcmV2YWxpZGF0aW9uXG4gICAgLy8gcmVxdWVzdC5cbiAgICBjb25zdCBpc1JldmFsaWRhdGUgPSBpc0lzciAmJiAhc3VwcG9ydHNEeW5hbWljUmVzcG9uc2U7XG4gICAgY29uc3QgbWV0aG9kID0gcmVxLm1ldGhvZCB8fCAnR0VUJztcbiAgICBjb25zdCB0cmFjZXIgPSBnZXRUcmFjZXIoKTtcbiAgICBjb25zdCBhY3RpdmVTcGFuID0gdHJhY2VyLmdldEFjdGl2ZVNjb3BlU3BhbigpO1xuICAgIGNvbnN0IGNvbnRleHQgPSB7XG4gICAgICAgIHBhcmFtcyxcbiAgICAgICAgcHJlcmVuZGVyTWFuaWZlc3QsXG4gICAgICAgIHJlbmRlck9wdHM6IHtcbiAgICAgICAgICAgIGV4cGVyaW1lbnRhbDoge1xuICAgICAgICAgICAgICAgIGNhY2hlQ29tcG9uZW50czogQm9vbGVhbihuZXh0Q29uZmlnLmV4cGVyaW1lbnRhbC5jYWNoZUNvbXBvbmVudHMpLFxuICAgICAgICAgICAgICAgIGF1dGhJbnRlcnJ1cHRzOiBCb29sZWFuKG5leHRDb25maWcuZXhwZXJpbWVudGFsLmF1dGhJbnRlcnJ1cHRzKVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHN1cHBvcnRzRHluYW1pY1Jlc3BvbnNlLFxuICAgICAgICAgICAgaW5jcmVtZW50YWxDYWNoZTogZ2V0UmVxdWVzdE1ldGEocmVxLCAnaW5jcmVtZW50YWxDYWNoZScpLFxuICAgICAgICAgICAgY2FjaGVMaWZlUHJvZmlsZXM6IChfbmV4dENvbmZpZ19leHBlcmltZW50YWwgPSBuZXh0Q29uZmlnLmV4cGVyaW1lbnRhbCkgPT0gbnVsbCA/IHZvaWQgMCA6IF9uZXh0Q29uZmlnX2V4cGVyaW1lbnRhbC5jYWNoZUxpZmUsXG4gICAgICAgICAgICBpc1JldmFsaWRhdGUsXG4gICAgICAgICAgICB3YWl0VW50aWw6IGN0eC53YWl0VW50aWwsXG4gICAgICAgICAgICBvbkNsb3NlOiAoY2IpPT57XG4gICAgICAgICAgICAgICAgcmVzLm9uKCdjbG9zZScsIGNiKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBvbkFmdGVyVGFza0Vycm9yOiB1bmRlZmluZWQsXG4gICAgICAgICAgICBvbkluc3RydW1lbnRhdGlvblJlcXVlc3RFcnJvcjogKGVycm9yLCBfcmVxdWVzdCwgZXJyb3JDb250ZXh0KT0+cm91dGVNb2R1bGUub25SZXF1ZXN0RXJyb3IocmVxLCBlcnJvciwgZXJyb3JDb250ZXh0LCByb3V0ZXJTZXJ2ZXJDb250ZXh0KVxuICAgICAgICB9LFxuICAgICAgICBzaGFyZWRDb250ZXh0OiB7XG4gICAgICAgICAgICBidWlsZElkXG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IG5vZGVOZXh0UmVxID0gbmV3IE5vZGVOZXh0UmVxdWVzdChyZXEpO1xuICAgIGNvbnN0IG5vZGVOZXh0UmVzID0gbmV3IE5vZGVOZXh0UmVzcG9uc2UocmVzKTtcbiAgICBjb25zdCBuZXh0UmVxID0gTmV4dFJlcXVlc3RBZGFwdGVyLmZyb21Ob2RlTmV4dFJlcXVlc3Qobm9kZU5leHRSZXEsIHNpZ25hbEZyb21Ob2RlUmVzcG9uc2UocmVzKSk7XG4gICAgdHJ5IHtcbiAgICAgICAgY29uc3QgaW52b2tlUm91dGVNb2R1bGUgPSBhc3luYyAoc3Bhbik9PntcbiAgICAgICAgICAgIHJldHVybiByb3V0ZU1vZHVsZS5oYW5kbGUobmV4dFJlcSwgY29udGV4dCkuZmluYWxseSgoKT0+e1xuICAgICAgICAgICAgICAgIGlmICghc3BhbikgcmV0dXJuO1xuICAgICAgICAgICAgICAgIHNwYW4uc2V0QXR0cmlidXRlcyh7XG4gICAgICAgICAgICAgICAgICAgICdodHRwLnN0YXR1c19jb2RlJzogcmVzLnN0YXR1c0NvZGUsXG4gICAgICAgICAgICAgICAgICAgICduZXh0LnJzYyc6IGZhbHNlXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgY29uc3Qgcm9vdFNwYW5BdHRyaWJ1dGVzID0gdHJhY2VyLmdldFJvb3RTcGFuQXR0cmlidXRlcygpO1xuICAgICAgICAgICAgICAgIC8vIFdlIHdlcmUgdW5hYmxlIHRvIGdldCBhdHRyaWJ1dGVzLCBwcm9iYWJseSBPVEVMIGlzIG5vdCBlbmFibGVkXG4gICAgICAgICAgICAgICAgaWYgKCFyb290U3BhbkF0dHJpYnV0ZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKSAhPT0gQmFzZVNlcnZlclNwYW4uaGFuZGxlUmVxdWVzdCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLndhcm4oYFVuZXhwZWN0ZWQgcm9vdCBzcGFuIHR5cGUgJyR7cm9vdFNwYW5BdHRyaWJ1dGVzLmdldCgnbmV4dC5zcGFuX3R5cGUnKX0nLiBQbGVhc2UgcmVwb3J0IHRoaXMgTmV4dC5qcyBpc3N1ZSBodHRwczovL2dpdGh1Yi5jb20vdmVyY2VsL25leHQuanNgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjb25zdCByb3V0ZSA9IHJvb3RTcGFuQXR0cmlidXRlcy5nZXQoJ25leHQucm91dGUnKTtcbiAgICAgICAgICAgICAgICBpZiAocm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGAke21ldGhvZH0gJHtyb3V0ZX1gO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnNldEF0dHJpYnV0ZXMoe1xuICAgICAgICAgICAgICAgICAgICAgICAgJ25leHQucm91dGUnOiByb3V0ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICdodHRwLnJvdXRlJzogcm91dGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbmV4dC5zcGFuX25hbWUnOiBuYW1lXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICBzcGFuLnVwZGF0ZU5hbWUobmFtZSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbi51cGRhdGVOYW1lKGAke21ldGhvZH0gJHtyZXEudXJsfWApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBoYW5kbGVSZXNwb25zZSA9IGFzeW5jIChjdXJyZW50U3Bhbik9PntcbiAgICAgICAgICAgIHZhciBfY2FjaGVFbnRyeV92YWx1ZTtcbiAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlR2VuZXJhdG9yID0gYXN5bmMgKHsgcHJldmlvdXNDYWNoZUVudHJ5IH0pPT57XG4gICAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFnZXRSZXF1ZXN0TWV0YShyZXEsICdtaW5pbWFsTW9kZScpICYmIGlzT25EZW1hbmRSZXZhbGlkYXRlICYmIHJldmFsaWRhdGVPbmx5R2VuZXJhdGVkICYmICFwcmV2aW91c0NhY2hlRW50cnkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXNDb2RlID0gNDA0O1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gb24tZGVtYW5kIHJldmFsaWRhdGUgYWx3YXlzIHNldHMgdGhpcyBoZWFkZXJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ3gtbmV4dGpzLWNhY2hlJywgJ1JFVkFMSURBVEVEJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXMuZW5kKCdUaGlzIHBhZ2UgY291bGQgbm90IGJlIGZvdW5kJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGludm9rZVJvdXRlTW9kdWxlKGN1cnJlbnRTcGFuKTtcbiAgICAgICAgICAgICAgICAgICAgcmVxLmZldGNoTWV0cmljcyA9IGNvbnRleHQucmVuZGVyT3B0cy5mZXRjaE1ldHJpY3M7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwZW5kaW5nV2FpdFVudGlsID0gY29udGV4dC5yZW5kZXJPcHRzLnBlbmRpbmdXYWl0VW50aWw7XG4gICAgICAgICAgICAgICAgICAgIC8vIEF0dGVtcHQgdXNpbmcgcHJvdmlkZWQgd2FpdFVudGlsIGlmIGF2YWlsYWJsZVxuICAgICAgICAgICAgICAgICAgICAvLyBpZiBpdCdzIG5vdCB3ZSBmYWxsYmFjayB0byBzZW5kUmVzcG9uc2UncyBoYW5kbGluZ1xuICAgICAgICAgICAgICAgICAgICBpZiAocGVuZGluZ1dhaXRVbnRpbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN0eC53YWl0VW50aWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdHgud2FpdFVudGlsKHBlbmRpbmdXYWl0VW50aWwpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdXYWl0VW50aWwgPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FjaGVUYWdzID0gY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFRhZ3M7XG4gICAgICAgICAgICAgICAgICAgIC8vIElmIHRoZSByZXF1ZXN0IGlzIGZvciBhIHN0YXRpYyByZXNwb25zZSwgd2UgY2FuIGNhY2hlIGl0IHNvIGxvbmdcbiAgICAgICAgICAgICAgICAgICAgLy8gYXMgaXQncyBub3QgZWRnZS5cbiAgICAgICAgICAgICAgICAgICAgaWYgKGlzSXNyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gYXdhaXQgcmVzcG9uc2UuYmxvYigpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ29weSB0aGUgaGVhZGVycyBmcm9tIHRoZSByZXNwb25zZS5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSB0b05vZGVPdXRnb2luZ0h0dHBIZWFkZXJzKHJlc3BvbnNlLmhlYWRlcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNhY2hlVGFncykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbTkVYVF9DQUNIRV9UQUdTX0hFQURFUl0gPSBjYWNoZVRhZ3M7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddICYmIGJsb2IudHlwZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnNbJ2NvbnRlbnQtdHlwZSddID0gYmxvYi50eXBlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV2YWxpZGF0ZSA9IHR5cGVvZiBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkUmV2YWxpZGF0ZSA9PT0gJ3VuZGVmaW5lZCcgfHwgY29udGV4dC5yZW5kZXJPcHRzLmNvbGxlY3RlZFJldmFsaWRhdGUgPj0gSU5GSU5JVEVfQ0FDSEUgPyBmYWxzZSA6IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRSZXZhbGlkYXRlO1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwaXJlID0gdHlwZW9mIGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRFeHBpcmUgPT09ICd1bmRlZmluZWQnIHx8IGNvbnRleHQucmVuZGVyT3B0cy5jb2xsZWN0ZWRFeHBpcmUgPj0gSU5GSU5JVEVfQ0FDSEUgPyB1bmRlZmluZWQgOiBjb250ZXh0LnJlbmRlck9wdHMuY29sbGVjdGVkRXhwaXJlO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBjYWNoZSBlbnRyeSBmb3IgdGhlIHJlc3BvbnNlLlxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FjaGVFbnRyeSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZToge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBraW5kOiBDYWNoZWRSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IHJlc3BvbnNlLnN0YXR1cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogQnVmZmVyLmZyb20oYXdhaXQgYmxvYi5hcnJheUJ1ZmZlcigpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZGVyc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2FjaGVDb250cm9sOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmFsaWRhdGUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY2FjaGVFbnRyeTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlbmQgcmVzcG9uc2Ugd2l0aG91dCBjYWNoaW5nIGlmIG5vdCBJU1JcbiAgICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IHNlbmRSZXNwb25zZShub2RlTmV4dFJlcSwgbm9kZU5leHRSZXMsIHJlc3BvbnNlLCBjb250ZXh0LnJlbmRlck9wdHMucGVuZGluZ1dhaXRVbnRpbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICAgICAgICAgICAgICAvLyBpZiB0aGlzIGlzIGEgYmFja2dyb3VuZCByZXZhbGlkYXRlIHdlIG5lZWQgdG8gcmVwb3J0XG4gICAgICAgICAgICAgICAgICAgIC8vIHRoZSByZXF1ZXN0IGVycm9yIGhlcmUgYXMgaXQgd29uJ3QgYmUgYnViYmxlZFxuICAgICAgICAgICAgICAgICAgICBpZiAocHJldmlvdXNDYWNoZUVudHJ5ID09IG51bGwgPyB2b2lkIDAgOiBwcmV2aW91c0NhY2hlRW50cnkuaXNTdGFsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYXdhaXQgcm91dGVNb2R1bGUub25SZXF1ZXN0RXJyb3IocmVxLCBlcnIsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXJLaW5kOiAnQXBwIFJvdXRlcicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGVQYXRoOiBzcmNQYWdlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvdXRlVHlwZTogJ3JvdXRlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZhbGlkYXRlUmVhc29uOiBnZXRSZXZhbGlkYXRlUmVhc29uKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNSZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc09uRGVtYW5kUmV2YWxpZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICB9LCByb3V0ZXJTZXJ2ZXJDb250ZXh0KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBlcnI7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGNvbnN0IGNhY2hlRW50cnkgPSBhd2FpdCByb3V0ZU1vZHVsZS5oYW5kbGVSZXNwb25zZSh7XG4gICAgICAgICAgICAgICAgcmVxLFxuICAgICAgICAgICAgICAgIG5leHRDb25maWcsXG4gICAgICAgICAgICAgICAgY2FjaGVLZXksXG4gICAgICAgICAgICAgICAgcm91dGVLaW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICAgICAgICAgIGlzRmFsbGJhY2s6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHByZXJlbmRlck1hbmlmZXN0LFxuICAgICAgICAgICAgICAgIGlzUm91dGVQUFJFbmFibGVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBpc09uRGVtYW5kUmV2YWxpZGF0ZSxcbiAgICAgICAgICAgICAgICByZXZhbGlkYXRlT25seUdlbmVyYXRlZCxcbiAgICAgICAgICAgICAgICByZXNwb25zZUdlbmVyYXRvcixcbiAgICAgICAgICAgICAgICB3YWl0VW50aWw6IGN0eC53YWl0VW50aWxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgLy8gd2UgZG9uJ3QgY3JlYXRlIGEgY2FjaGVFbnRyeSBmb3IgSVNSXG4gICAgICAgICAgICBpZiAoIWlzSXNyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoKGNhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IChfY2FjaGVFbnRyeV92YWx1ZSA9IGNhY2hlRW50cnkudmFsdWUpID09IG51bGwgPyB2b2lkIDAgOiBfY2FjaGVFbnRyeV92YWx1ZS5raW5kKSAhPT0gQ2FjaGVkUm91dGVLaW5kLkFQUF9ST1VURSkge1xuICAgICAgICAgICAgICAgIHZhciBfY2FjaGVFbnRyeV92YWx1ZTE7XG4gICAgICAgICAgICAgICAgdGhyb3cgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ldyBFcnJvcihgSW52YXJpYW50OiBhcHAtcm91dGUgcmVjZWl2ZWQgaW52YWxpZCBjYWNoZSBlbnRyeSAke2NhY2hlRW50cnkgPT0gbnVsbCA/IHZvaWQgMCA6IChfY2FjaGVFbnRyeV92YWx1ZTEgPSBjYWNoZUVudHJ5LnZhbHVlKSA9PSBudWxsID8gdm9pZCAwIDogX2NhY2hlRW50cnlfdmFsdWUxLmtpbmR9YCksIFwiX19ORVhUX0VSUk9SX0NPREVcIiwge1xuICAgICAgICAgICAgICAgICAgICB2YWx1ZTogXCJFNzAxXCIsXG4gICAgICAgICAgICAgICAgICAgIGVudW1lcmFibGU6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBjb25maWd1cmFibGU6IHRydWVcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghZ2V0UmVxdWVzdE1ldGEocmVxLCAnbWluaW1hbE1vZGUnKSkge1xuICAgICAgICAgICAgICAgIHJlcy5zZXRIZWFkZXIoJ3gtbmV4dGpzLWNhY2hlJywgaXNPbkRlbWFuZFJldmFsaWRhdGUgPyAnUkVWQUxJREFURUQnIDogY2FjaGVFbnRyeS5pc01pc3MgPyAnTUlTUycgOiBjYWNoZUVudHJ5LmlzU3RhbGUgPyAnU1RBTEUnIDogJ0hJVCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gRHJhZnQgbW9kZSBzaG91bGQgbmV2ZXIgYmUgY2FjaGVkXG4gICAgICAgICAgICBpZiAoaXNEcmFmdE1vZGUpIHtcbiAgICAgICAgICAgICAgICByZXMuc2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJywgJ3ByaXZhdGUsIG5vLWNhY2hlLCBuby1zdG9yZSwgbWF4LWFnZT0wLCBtdXN0LXJldmFsaWRhdGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBmcm9tTm9kZU91dGdvaW5nSHR0cEhlYWRlcnMoY2FjaGVFbnRyeS52YWx1ZS5oZWFkZXJzKTtcbiAgICAgICAgICAgIGlmICghKGdldFJlcXVlc3RNZXRhKHJlcSwgJ21pbmltYWxNb2RlJykgJiYgaXNJc3IpKSB7XG4gICAgICAgICAgICAgICAgaGVhZGVycy5kZWxldGUoTkVYVF9DQUNIRV9UQUdTX0hFQURFUik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBJZiBjYWNoZSBjb250cm9sIGlzIGFscmVhZHkgc2V0IG9uIHRoZSByZXNwb25zZSB3ZSBkb24ndFxuICAgICAgICAgICAgLy8gb3ZlcnJpZGUgaXQgdG8gYWxsb3cgdXNlcnMgdG8gY3VzdG9taXplIGl0IHZpYSBuZXh0LmNvbmZpZ1xuICAgICAgICAgICAgaWYgKGNhY2hlRW50cnkuY2FjaGVDb250cm9sICYmICFyZXMuZ2V0SGVhZGVyKCdDYWNoZS1Db250cm9sJykgJiYgIWhlYWRlcnMuZ2V0KCdDYWNoZS1Db250cm9sJykpIHtcbiAgICAgICAgICAgICAgICBoZWFkZXJzLnNldCgnQ2FjaGUtQ29udHJvbCcsIGdldENhY2hlQ29udHJvbEhlYWRlcihjYWNoZUVudHJ5LmNhY2hlQ29udHJvbCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgbmV3IFJlc3BvbnNlKGNhY2hlRW50cnkudmFsdWUuYm9keSwge1xuICAgICAgICAgICAgICAgIGhlYWRlcnMsXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBjYWNoZUVudHJ5LnZhbHVlLnN0YXR1cyB8fCAyMDBcbiAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9O1xuICAgICAgICAvLyBUT0RPOiBhY3RpdmVTcGFuIGNvZGUgcGF0aCBpcyBmb3Igd2hlbiB3cmFwcGVkIGJ5XG4gICAgICAgIC8vIG5leHQtc2VydmVyIGNhbiBiZSByZW1vdmVkIHdoZW4gdGhpcyBpcyBubyBsb25nZXIgdXNlZFxuICAgICAgICBpZiAoYWN0aXZlU3Bhbikge1xuICAgICAgICAgICAgYXdhaXQgaGFuZGxlUmVzcG9uc2UoYWN0aXZlU3Bhbik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhd2FpdCB0cmFjZXIud2l0aFByb3BhZ2F0ZWRDb250ZXh0KHJlcS5oZWFkZXJzLCAoKT0+dHJhY2VyLnRyYWNlKEJhc2VTZXJ2ZXJTcGFuLmhhbmRsZVJlcXVlc3QsIHtcbiAgICAgICAgICAgICAgICAgICAgc3Bhbk5hbWU6IGAke21ldGhvZH0gJHtyZXEudXJsfWAsXG4gICAgICAgICAgICAgICAgICAgIGtpbmQ6IFNwYW5LaW5kLlNFUlZFUixcbiAgICAgICAgICAgICAgICAgICAgYXR0cmlidXRlczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAubWV0aG9kJzogbWV0aG9kLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2h0dHAudGFyZ2V0JzogcmVxLnVybFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgaGFuZGxlUmVzcG9uc2UpKTtcbiAgICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgICBpZiAoIShlcnIgaW5zdGFuY2VvZiBOb0ZhbGxiYWNrRXJyb3IpKSB7XG4gICAgICAgICAgICBhd2FpdCByb3V0ZU1vZHVsZS5vblJlcXVlc3RFcnJvcihyZXEsIGVyciwge1xuICAgICAgICAgICAgICAgIHJvdXRlcktpbmQ6ICdBcHAgUm91dGVyJyxcbiAgICAgICAgICAgICAgICByb3V0ZVBhdGg6IG5vcm1hbGl6ZWRTcmNQYWdlLFxuICAgICAgICAgICAgICAgIHJvdXRlVHlwZTogJ3JvdXRlJyxcbiAgICAgICAgICAgICAgICByZXZhbGlkYXRlUmVhc29uOiBnZXRSZXZhbGlkYXRlUmVhc29uKHtcbiAgICAgICAgICAgICAgICAgICAgaXNSZXZhbGlkYXRlLFxuICAgICAgICAgICAgICAgICAgICBpc09uRGVtYW5kUmV2YWxpZGF0ZVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICAvLyByZXRocm93IHNvIHRoYXQgd2UgY2FuIGhhbmRsZSBzZXJ2aW5nIGVycm9yIHBhZ2VcbiAgICAgICAgLy8gSWYgdGhpcyBpcyBkdXJpbmcgc3RhdGljIGdlbmVyYXRpb24sIHRocm93IHRoZSBlcnJvciBhZ2Fpbi5cbiAgICAgICAgaWYgKGlzSXNyKSB0aHJvdyBlcnI7XG4gICAgICAgIC8vIE90aGVyd2lzZSwgc2VuZCBhIDUwMCByZXNwb25zZS5cbiAgICAgICAgYXdhaXQgc2VuZFJlc3BvbnNlKG5vZGVOZXh0UmVxLCBub2RlTmV4dFJlcywgbmV3IFJlc3BvbnNlKG51bGwsIHtcbiAgICAgICAgICAgIHN0YXR1czogNTAwXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxufVxuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwXG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fstats%2Froute&page=%2Fapi%2Fstats%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstats%2Froute.ts&appDir=%2FUsers%2Fsheirraza%2Fakhai%2Fpackages%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fsheirraza%2Fakhai%2Fpackages%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!\n");

/***/ }),

/***/ "(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!***********************************************************************************************************************************************************************!*\
  !*** ../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \***********************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./app/api/stats/route.ts":
/*!********************************!*\
  !*** ./app/api/stats/route.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_database__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/database */ \"(rsc)/./lib/database.ts\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./lib/auth.ts\");\n\n\n\nasync function GET(request) {\n    try {\n        // Get user from session (optional - allows anonymous usage)\n        const token = request.cookies.get('session_token')?.value;\n        const user = token ? (0,_lib_auth__WEBPACK_IMPORTED_MODULE_2__.getUserFromSession)(token) : null;\n        const userId = user?.id || null;\n        const stats = (0,_lib_database__WEBPACK_IMPORTED_MODULE_1__.getStats)(userId);\n        // Build provider status from database stats and environment variables\n        const providerStatsMap = new Map(stats.providerStats.map((p)=>[\n                p.provider,\n                p\n            ]));\n        const anthropicStatus = process.env.ANTHROPIC_API_KEY ? 'active' : 'inactive';\n        const deepseekStatus = process.env.DEEPSEEK_API_KEY ? 'active' : 'inactive';\n        const xaiStatus = process.env.XAI_API_KEY ? 'active' : 'inactive';\n        const mistralStatus = process.env.MISTRAL_API_KEY ? 'active' : 'inactive';\n        const openrouterStatus = process.env.OPENROUTER_API_KEY ? 'active' : 'inactive';\n        const providers = {\n            anthropic: {\n                status: anthropicStatus,\n                queries: providerStatsMap.get('anthropic')?.queries || 0,\n                cost: providerStatsMap.get('anthropic')?.cost || 0\n            },\n            deepseek: {\n                status: deepseekStatus,\n                queries: providerStatsMap.get('deepseek')?.queries || 0,\n                cost: providerStatsMap.get('deepseek')?.cost || 0\n            },\n            xai: {\n                status: xaiStatus,\n                queries: providerStatsMap.get('xai')?.queries || 0,\n                cost: providerStatsMap.get('xai')?.cost || 0\n            },\n            mistral: {\n                status: mistralStatus,\n                queries: providerStatsMap.get('mistral')?.queries || 0,\n                cost: providerStatsMap.get('mistral')?.cost || 0\n            },\n            openrouter: {\n                status: openrouterStatus,\n                queries: providerStatsMap.get('openrouter')?.queries || 0,\n                cost: providerStatsMap.get('openrouter')?.cost || 0\n            }\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            queriesToday: stats.queriesToday,\n            queriesThisMonth: stats.queriesThisMonth,\n            totalTokens: stats.totalTokens,\n            totalCost: stats.totalCost,\n            avgResponseTime: Math.round(stats.avgResponseTime * 10) / 10,\n            providers\n        });\n    } catch (error) {\n        console.error('Stats API error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to fetch statistics'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3N0YXRzL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBd0Q7QUFDZDtBQUNNO0FBSXpDLGVBQWVHLElBQUlDLE9BQW9CO0lBQzVDLElBQUk7UUFDRiw0REFBNEQ7UUFDNUQsTUFBTUMsUUFBUUQsUUFBUUUsT0FBTyxDQUFDQyxHQUFHLENBQUMsa0JBQWtCQztRQUNwRCxNQUFNQyxPQUFPSixRQUFRSCw2REFBa0JBLENBQUNHLFNBQVM7UUFDakQsTUFBTUssU0FBU0QsTUFBTUUsTUFBTTtRQUUzQixNQUFNQyxRQUFRWCx1REFBUUEsQ0FBQ1M7UUFFdkIsc0VBQXNFO1FBQ3RFLE1BQU1HLG1CQUFtQixJQUFJQyxJQUMzQkYsTUFBTUcsYUFBYSxDQUFDQyxHQUFHLENBQUMsQ0FBQ0MsSUFBTTtnQkFBQ0EsRUFBRUMsUUFBUTtnQkFBRUQ7YUFBRTtRQUdoRCxNQUFNRSxrQkFBa0NDLFFBQVFDLEdBQUcsQ0FBQ0MsaUJBQWlCLEdBQUcsV0FBVztRQUNuRixNQUFNQyxpQkFBaUNILFFBQVFDLEdBQUcsQ0FBQ0csZ0JBQWdCLEdBQUcsV0FBVztRQUNqRixNQUFNQyxZQUE0QkwsUUFBUUMsR0FBRyxDQUFDSyxXQUFXLEdBQUcsV0FBVztRQUN2RSxNQUFNQyxnQkFBZ0NQLFFBQVFDLEdBQUcsQ0FBQ08sZUFBZSxHQUFHLFdBQVc7UUFDL0UsTUFBTUMsbUJBQW1DVCxRQUFRQyxHQUFHLENBQUNTLGtCQUFrQixHQUFHLFdBQVc7UUFFckYsTUFBTUMsWUFBWTtZQUNoQkMsV0FBVztnQkFDVEMsUUFBUWQ7Z0JBQ1JlLFNBQVNyQixpQkFBaUJOLEdBQUcsQ0FBQyxjQUFjMkIsV0FBVztnQkFDdkRDLE1BQU10QixpQkFBaUJOLEdBQUcsQ0FBQyxjQUFjNEIsUUFBUTtZQUNuRDtZQUNBQyxVQUFVO2dCQUNSSCxRQUFRVjtnQkFDUlcsU0FBU3JCLGlCQUFpQk4sR0FBRyxDQUFDLGFBQWEyQixXQUFXO2dCQUN0REMsTUFBTXRCLGlCQUFpQk4sR0FBRyxDQUFDLGFBQWE0QixRQUFRO1lBQ2xEO1lBQ0FFLEtBQUs7Z0JBQ0hKLFFBQVFSO2dCQUNSUyxTQUFTckIsaUJBQWlCTixHQUFHLENBQUMsUUFBUTJCLFdBQVc7Z0JBQ2pEQyxNQUFNdEIsaUJBQWlCTixHQUFHLENBQUMsUUFBUTRCLFFBQVE7WUFDN0M7WUFDQUcsU0FBUztnQkFDUEwsUUFBUU47Z0JBQ1JPLFNBQVNyQixpQkFBaUJOLEdBQUcsQ0FBQyxZQUFZMkIsV0FBVztnQkFDckRDLE1BQU10QixpQkFBaUJOLEdBQUcsQ0FBQyxZQUFZNEIsUUFBUTtZQUNqRDtZQUNBSSxZQUFZO2dCQUNWTixRQUFRSjtnQkFDUkssU0FBU3JCLGlCQUFpQk4sR0FBRyxDQUFDLGVBQWUyQixXQUFXO2dCQUN4REMsTUFBTXRCLGlCQUFpQk4sR0FBRyxDQUFDLGVBQWU0QixRQUFRO1lBQ3BEO1FBQ0Y7UUFFQSxPQUFPbkMscURBQVlBLENBQUN3QyxJQUFJLENBQUM7WUFDdkJDLGNBQWM3QixNQUFNNkIsWUFBWTtZQUNoQ0Msa0JBQWtCOUIsTUFBTThCLGdCQUFnQjtZQUN4Q0MsYUFBYS9CLE1BQU0rQixXQUFXO1lBQzlCQyxXQUFXaEMsTUFBTWdDLFNBQVM7WUFDMUJDLGlCQUFpQkMsS0FBS0MsS0FBSyxDQUFDbkMsTUFBTWlDLGVBQWUsR0FBRyxNQUFNO1lBQzFEZDtRQUNGO0lBQ0YsRUFBRSxPQUFPaUIsT0FBTztRQUNkQyxRQUFRRCxLQUFLLENBQUMsb0JBQW9CQTtRQUNsQyxPQUFPaEQscURBQVlBLENBQUN3QyxJQUFJLENBQ3RCO1lBQUVRLE9BQU87UUFBNkIsR0FDdEM7WUFBRWYsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9zaGVpcnJhemEvYWtoYWkvcGFja2FnZXMvd2ViL2FwcC9hcGkvc3RhdHMvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGdldFN0YXRzIH0gZnJvbSAnQC9saWIvZGF0YWJhc2UnO1xuaW1wb3J0IHsgZ2V0VXNlckZyb21TZXNzaW9uIH0gZnJvbSAnQC9saWIvYXV0aCc7XG5cbnR5cGUgUHJvdmlkZXJTdGF0dXMgPSAnYWN0aXZlJyB8ICdpbmFjdGl2ZScgfCAnZXJyb3InO1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgLy8gR2V0IHVzZXIgZnJvbSBzZXNzaW9uIChvcHRpb25hbCAtIGFsbG93cyBhbm9ueW1vdXMgdXNhZ2UpXG4gICAgY29uc3QgdG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KCdzZXNzaW9uX3Rva2VuJyk/LnZhbHVlXG4gICAgY29uc3QgdXNlciA9IHRva2VuID8gZ2V0VXNlckZyb21TZXNzaW9uKHRva2VuKSA6IG51bGxcbiAgICBjb25zdCB1c2VySWQgPSB1c2VyPy5pZCB8fCBudWxsXG5cbiAgICBjb25zdCBzdGF0cyA9IGdldFN0YXRzKHVzZXJJZCk7XG5cbiAgICAvLyBCdWlsZCBwcm92aWRlciBzdGF0dXMgZnJvbSBkYXRhYmFzZSBzdGF0cyBhbmQgZW52aXJvbm1lbnQgdmFyaWFibGVzXG4gICAgY29uc3QgcHJvdmlkZXJTdGF0c01hcCA9IG5ldyBNYXAoXG4gICAgICBzdGF0cy5wcm92aWRlclN0YXRzLm1hcCgocCkgPT4gW3AucHJvdmlkZXIsIHBdKVxuICAgICk7XG5cbiAgICBjb25zdCBhbnRocm9waWNTdGF0dXM6IFByb3ZpZGVyU3RhdHVzID0gcHJvY2Vzcy5lbnYuQU5USFJPUElDX0FQSV9LRVkgPyAnYWN0aXZlJyA6ICdpbmFjdGl2ZSc7XG4gICAgY29uc3QgZGVlcHNlZWtTdGF0dXM6IFByb3ZpZGVyU3RhdHVzID0gcHJvY2Vzcy5lbnYuREVFUFNFRUtfQVBJX0tFWSA/ICdhY3RpdmUnIDogJ2luYWN0aXZlJztcbiAgICBjb25zdCB4YWlTdGF0dXM6IFByb3ZpZGVyU3RhdHVzID0gcHJvY2Vzcy5lbnYuWEFJX0FQSV9LRVkgPyAnYWN0aXZlJyA6ICdpbmFjdGl2ZSc7XG4gICAgY29uc3QgbWlzdHJhbFN0YXR1czogUHJvdmlkZXJTdGF0dXMgPSBwcm9jZXNzLmVudi5NSVNUUkFMX0FQSV9LRVkgPyAnYWN0aXZlJyA6ICdpbmFjdGl2ZSc7XG4gICAgY29uc3Qgb3BlbnJvdXRlclN0YXR1czogUHJvdmlkZXJTdGF0dXMgPSBwcm9jZXNzLmVudi5PUEVOUk9VVEVSX0FQSV9LRVkgPyAnYWN0aXZlJyA6ICdpbmFjdGl2ZSc7XG5cbiAgICBjb25zdCBwcm92aWRlcnMgPSB7XG4gICAgICBhbnRocm9waWM6IHtcbiAgICAgICAgc3RhdHVzOiBhbnRocm9waWNTdGF0dXMsXG4gICAgICAgIHF1ZXJpZXM6IHByb3ZpZGVyU3RhdHNNYXAuZ2V0KCdhbnRocm9waWMnKT8ucXVlcmllcyB8fCAwLFxuICAgICAgICBjb3N0OiBwcm92aWRlclN0YXRzTWFwLmdldCgnYW50aHJvcGljJyk/LmNvc3QgfHwgMCxcbiAgICAgIH0sXG4gICAgICBkZWVwc2Vlazoge1xuICAgICAgICBzdGF0dXM6IGRlZXBzZWVrU3RhdHVzLFxuICAgICAgICBxdWVyaWVzOiBwcm92aWRlclN0YXRzTWFwLmdldCgnZGVlcHNlZWsnKT8ucXVlcmllcyB8fCAwLFxuICAgICAgICBjb3N0OiBwcm92aWRlclN0YXRzTWFwLmdldCgnZGVlcHNlZWsnKT8uY29zdCB8fCAwLFxuICAgICAgfSxcbiAgICAgIHhhaToge1xuICAgICAgICBzdGF0dXM6IHhhaVN0YXR1cyxcbiAgICAgICAgcXVlcmllczogcHJvdmlkZXJTdGF0c01hcC5nZXQoJ3hhaScpPy5xdWVyaWVzIHx8IDAsXG4gICAgICAgIGNvc3Q6IHByb3ZpZGVyU3RhdHNNYXAuZ2V0KCd4YWknKT8uY29zdCB8fCAwLFxuICAgICAgfSxcbiAgICAgIG1pc3RyYWw6IHtcbiAgICAgICAgc3RhdHVzOiBtaXN0cmFsU3RhdHVzLFxuICAgICAgICBxdWVyaWVzOiBwcm92aWRlclN0YXRzTWFwLmdldCgnbWlzdHJhbCcpPy5xdWVyaWVzIHx8IDAsXG4gICAgICAgIGNvc3Q6IHByb3ZpZGVyU3RhdHNNYXAuZ2V0KCdtaXN0cmFsJyk/LmNvc3QgfHwgMCxcbiAgICAgIH0sXG4gICAgICBvcGVucm91dGVyOiB7XG4gICAgICAgIHN0YXR1czogb3BlbnJvdXRlclN0YXR1cyxcbiAgICAgICAgcXVlcmllczogcHJvdmlkZXJTdGF0c01hcC5nZXQoJ29wZW5yb3V0ZXInKT8ucXVlcmllcyB8fCAwLFxuICAgICAgICBjb3N0OiBwcm92aWRlclN0YXRzTWFwLmdldCgnb3BlbnJvdXRlcicpPy5jb3N0IHx8IDAsXG4gICAgICB9LFxuICAgIH07XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgcXVlcmllc1RvZGF5OiBzdGF0cy5xdWVyaWVzVG9kYXksXG4gICAgICBxdWVyaWVzVGhpc01vbnRoOiBzdGF0cy5xdWVyaWVzVGhpc01vbnRoLFxuICAgICAgdG90YWxUb2tlbnM6IHN0YXRzLnRvdGFsVG9rZW5zLFxuICAgICAgdG90YWxDb3N0OiBzdGF0cy50b3RhbENvc3QsXG4gICAgICBhdmdSZXNwb25zZVRpbWU6IE1hdGgucm91bmQoc3RhdHMuYXZnUmVzcG9uc2VUaW1lICogMTApIC8gMTAsXG4gICAgICBwcm92aWRlcnMsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignU3RhdHMgQVBJIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIHN0YXRpc3RpY3MnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0U3RhdHMiLCJnZXRVc2VyRnJvbVNlc3Npb24iLCJHRVQiLCJyZXF1ZXN0IiwidG9rZW4iLCJjb29raWVzIiwiZ2V0IiwidmFsdWUiLCJ1c2VyIiwidXNlcklkIiwiaWQiLCJzdGF0cyIsInByb3ZpZGVyU3RhdHNNYXAiLCJNYXAiLCJwcm92aWRlclN0YXRzIiwibWFwIiwicCIsInByb3ZpZGVyIiwiYW50aHJvcGljU3RhdHVzIiwicHJvY2VzcyIsImVudiIsIkFOVEhST1BJQ19BUElfS0VZIiwiZGVlcHNlZWtTdGF0dXMiLCJERUVQU0VFS19BUElfS0VZIiwieGFpU3RhdHVzIiwiWEFJX0FQSV9LRVkiLCJtaXN0cmFsU3RhdHVzIiwiTUlTVFJBTF9BUElfS0VZIiwib3BlbnJvdXRlclN0YXR1cyIsIk9QRU5ST1VURVJfQVBJX0tFWSIsInByb3ZpZGVycyIsImFudGhyb3BpYyIsInN0YXR1cyIsInF1ZXJpZXMiLCJjb3N0IiwiZGVlcHNlZWsiLCJ4YWkiLCJtaXN0cmFsIiwib3BlbnJvdXRlciIsImpzb24iLCJxdWVyaWVzVG9kYXkiLCJxdWVyaWVzVGhpc01vbnRoIiwidG90YWxUb2tlbnMiLCJ0b3RhbENvc3QiLCJhdmdSZXNwb25zZVRpbWUiLCJNYXRoIiwicm91bmQiLCJlcnJvciIsImNvbnNvbGUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/stats/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   authenticateWallet: () => (/* binding */ authenticateWallet),\n/* harmony export */   generateWalletMessage: () => (/* binding */ generateWalletMessage),\n/* harmony export */   getGitHubAuthUrl: () => (/* binding */ getGitHubAuthUrl),\n/* harmony export */   getUserFromSession: () => (/* binding */ getUserFromSession),\n/* harmony export */   handleGitHubCallback: () => (/* binding */ handleGitHubCallback),\n/* harmony export */   isAdmin: () => (/* binding */ isAdmin),\n/* harmony export */   logout: () => (/* binding */ logout),\n/* harmony export */   verifyWalletSignature: () => (/* binding */ verifyWalletSignature)\n/* harmony export */ });\n/* harmony import */ var _database__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./database */ \"(rsc)/./lib/database.ts\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_1__);\n/**\n * Authentication Service\n * \n * Handles GitHub OAuth and Wallet authentication\n */ \n\nconst SESSION_DURATION_SECONDS = 30 * 24 * 60 * 60; // 30 days\n/**\n * Admin/Founder Configuration\n * Only the founder can see provider status and costs\n */ const ADMIN_GITHUB_USERNAME = process.env.ADMIN_GITHUB_USERNAME || 'algoq369';\n/**\n * Check if a user is the admin/founder\n */ function isAdmin(user) {\n    if (!user) return false;\n    // Admin is identified by GitHub username\n    return user.auth_provider === 'github' && user.username === ADMIN_GITHUB_USERNAME;\n}\n/**\n * GitHub OAuth Configuration\n */ const GITHUB_CLIENT_ID = process.env.GITHUB_CLIENT_ID || '';\nconst GITHUB_CLIENT_SECRET = process.env.GITHUB_CLIENT_SECRET || '';\n// Use NEXT_PUBLIC_VERCEL_URL or default to localhost:3002 (common Next.js dev port)\nconst baseUrl = process.env.NEXT_PUBLIC_VERCEL_URL ? `https://${process.env.NEXT_PUBLIC_VERCEL_URL}` : process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3002';\nconst GITHUB_REDIRECT_URI = process.env.GITHUB_REDIRECT_URI || `${baseUrl}/api/auth/github/callback`;\n/**\n * Generate GitHub OAuth authorization URL\n */ function getGitHubAuthUrl() {\n    if (!GITHUB_CLIENT_ID) {\n        throw new Error('GITHUB_CLIENT_ID is not configured. Please add it to .env.local');\n    }\n    const state = (0,crypto__WEBPACK_IMPORTED_MODULE_1__.randomBytes)(16).toString('hex');\n    const params = new URLSearchParams({\n        client_id: GITHUB_CLIENT_ID,\n        redirect_uri: GITHUB_REDIRECT_URI,\n        scope: 'read:user user:email',\n        state\n    });\n    return `https://github.com/login/oauth/authorize?${params.toString()}`;\n}\n/**\n * Handle GitHub OAuth callback\n */ async function handleGitHubCallback(code) {\n    // Exchange code for access token\n    const tokenResponse = await fetch('https://github.com/login/oauth/access_token', {\n        method: 'POST',\n        headers: {\n            'Content-Type': 'application/json',\n            Accept: 'application/json'\n        },\n        body: JSON.stringify({\n            client_id: GITHUB_CLIENT_ID,\n            client_secret: GITHUB_CLIENT_SECRET,\n            code\n        })\n    });\n    const tokenData = await tokenResponse.json();\n    if (!tokenData.access_token) {\n        throw new Error('Failed to get access token from GitHub');\n    }\n    // Get user info from GitHub\n    const userResponse = await fetch('https://api.github.com/user', {\n        headers: {\n            Authorization: `Bearer ${tokenData.access_token}`,\n            Accept: 'application/vnd.github.v3+json'\n        }\n    });\n    const githubUser = await userResponse.json();\n    // Create or update user\n    const user = (0,_database__WEBPACK_IMPORTED_MODULE_0__.createOrGetUser)('github', githubUser.id.toString(), {\n        username: githubUser.login,\n        email: githubUser.email || null,\n        avatar_url: githubUser.avatar_url || null\n    });\n    // Create session\n    const session = (0,_database__WEBPACK_IMPORTED_MODULE_0__.createSession)(user.id, SESSION_DURATION_SECONDS);\n    return {\n        user,\n        session: {\n            token: session.token\n        }\n    };\n}\n/**\n * Wallet Authentication\n */ /**\n * Generate message for wallet signature\n */ function generateWalletMessage(address) {\n    const timestamp = Date.now();\n    return `Sign this message to authenticate with AkhAI.\\n\\nAddress: ${address}\\nTimestamp: ${timestamp}`;\n}\n/**\n * Verify wallet signature (simplified - in production, use proper EIP-191 verification)\n */ function verifyWalletSignature(address, signature, message) {\n    // In production, use ethers.js or web3.js to properly verify EIP-191 signatures\n    // For now, this is a placeholder that accepts any signature\n    // TODO: Implement proper signature verification\n    return true;\n}\n/**\n * Authenticate with wallet\n */ function authenticateWallet(address, signature, message) {\n    // Verify signature\n    if (!verifyWalletSignature(address, signature, message)) {\n        throw new Error('Invalid wallet signature');\n    }\n    // Create or get user\n    const user = (0,_database__WEBPACK_IMPORTED_MODULE_0__.createOrGetUser)('wallet', address.toLowerCase(), {\n        username: `${address.slice(0, 6)}...${address.slice(-4)}`\n    });\n    // Create session\n    const session = (0,_database__WEBPACK_IMPORTED_MODULE_0__.createSession)(user.id, SESSION_DURATION_SECONDS);\n    return {\n        user,\n        session: {\n            token: session.token\n        }\n    };\n}\n/**\n * Session Management\n */ /**\n * Get user from session token\n */ function getUserFromSession(token) {\n    return (0,_database__WEBPACK_IMPORTED_MODULE_0__.validateSession)(token);\n}\n/**\n * Logout (destroy session)\n */ function logout(token) {\n    (0,_database__WEBPACK_IMPORTED_MODULE_0__.destroySession)(token);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxHQUNNLFNBQVNHLHNCQUFzQkosT0FBZSxFQUFFSyxTQUFpQixFQUFFQyxPQUFlO0lBQ3ZGLGdGQUFnRjtJQUNoRiw0REFBNEQ7SUFDNUQsZ0RBQWdEO0lBQ2hELE9BQU87QUFDVDtBQUVBOztDQUVDLEdBQ00sU0FBU0MsbUJBQW1CUCxPQUFlLEVBQUVLLFNBQWlCLEVBQUVDLE9BQWU7SUFDcEYsbUJBQW1CO0lBQ25CLElBQUksQ0FBQ0Ysc0JBQXNCSixTQUFTSyxXQUFXQyxVQUFVO1FBQ3ZELE1BQU0sSUFBSXRDLE1BQU07SUFDbEI7SUFFQSxxQkFBcUI7SUFDckIsTUFBTVYsT0FBT1YsMERBQWVBLENBQUMsVUFBVW9ELFFBQVFRLFdBQVcsSUFBSTtRQUM1RGhELFVBQVUsR0FBR3dDLFFBQVFTLEtBQUssQ0FBQyxHQUFHLEdBQUcsR0FBRyxFQUFFVCxRQUFRUyxLQUFLLENBQUMsQ0FBQyxJQUFJO0lBQzNEO0lBRUEsaUJBQWlCO0lBQ2pCLE1BQU1aLFVBQVVoRCx3REFBYUEsQ0FBQ1MsS0FBS21DLEVBQUUsRUFBRXhDO0lBRXZDLE9BQU87UUFDTEs7UUFDQXVDLFNBQVM7WUFBRUMsT0FBT0QsUUFBUUMsS0FBSztRQUFDO0lBQ2xDO0FBQ0Y7QUFFQTs7Q0FFQyxHQUVEOztDQUVDLEdBQ00sU0FBU1ksbUJBQW1CWixLQUFhO0lBQzlDLE9BQU9oRCwwREFBZUEsQ0FBQ2dEO0FBQ3pCO0FBRUE7O0NBRUMsR0FDTSxTQUFTYSxPQUFPYixLQUFhO0lBQ2xDL0MseURBQWNBLENBQUMrQztBQUNqQiIsInNvdXJjZXMiOlsiL1VzZXJzL3NoZWlycmF6YS9ha2hhaS9wYWNrYWdlcy93ZWIvbGliL2F1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBBdXRoZW50aWNhdGlvbiBTZXJ2aWNlXG4gKiBcbiAqIEhhbmRsZXMgR2l0SHViIE9BdXRoIGFuZCBXYWxsZXQgYXV0aGVudGljYXRpb25cbiAqL1xuXG5pbXBvcnQgeyBjcmVhdGVPckdldFVzZXIsIGNyZWF0ZVNlc3Npb24sIHZhbGlkYXRlU2Vzc2lvbiwgZGVzdHJveVNlc3Npb24sIFVzZXIgfSBmcm9tICcuL2RhdGFiYXNlJztcbmltcG9ydCB7IHJhbmRvbUJ5dGVzIH0gZnJvbSAnY3J5cHRvJztcblxuY29uc3QgU0VTU0lPTl9EVVJBVElPTl9TRUNPTkRTID0gMzAgKiAyNCAqIDYwICogNjA7IC8vIDMwIGRheXNcblxuLyoqXG4gKiBBZG1pbi9Gb3VuZGVyIENvbmZpZ3VyYXRpb25cbiAqIE9ubHkgdGhlIGZvdW5kZXIgY2FuIHNlZSBwcm92aWRlciBzdGF0dXMgYW5kIGNvc3RzXG4gKi9cbmNvbnN0IEFETUlOX0dJVEhVQl9VU0VSTkFNRSA9IHByb2Nlc3MuZW52LkFETUlOX0dJVEhVQl9VU0VSTkFNRSB8fCAnYWxnb3EzNjknO1xuXG4vKipcbiAqIENoZWNrIGlmIGEgdXNlciBpcyB0aGUgYWRtaW4vZm91bmRlclxuICovXG5leHBvcnQgZnVuY3Rpb24gaXNBZG1pbih1c2VyOiBVc2VyIHwgbnVsbCk6IGJvb2xlYW4ge1xuICBpZiAoIXVzZXIpIHJldHVybiBmYWxzZTtcbiAgLy8gQWRtaW4gaXMgaWRlbnRpZmllZCBieSBHaXRIdWIgdXNlcm5hbWVcbiAgcmV0dXJuIHVzZXIuYXV0aF9wcm92aWRlciA9PT0gJ2dpdGh1YicgJiYgdXNlci51c2VybmFtZSA9PT0gQURNSU5fR0lUSFVCX1VTRVJOQU1FO1xufVxuXG4vKipcbiAqIEdpdEh1YiBPQXV0aCBDb25maWd1cmF0aW9uXG4gKi9cbmNvbnN0IEdJVEhVQl9DTElFTlRfSUQgPSBwcm9jZXNzLmVudi5HSVRIVUJfQ0xJRU5UX0lEIHx8ICcnO1xuY29uc3QgR0lUSFVCX0NMSUVOVF9TRUNSRVQgPSBwcm9jZXNzLmVudi5HSVRIVUJfQ0xJRU5UX1NFQ1JFVCB8fCAnJztcbi8vIFVzZSBORVhUX1BVQkxJQ19WRVJDRUxfVVJMIG9yIGRlZmF1bHQgdG8gbG9jYWxob3N0OjMwMDIgKGNvbW1vbiBOZXh0LmpzIGRldiBwb3J0KVxuY29uc3QgYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1ZFUkNFTF9VUkwgXG4gID8gYGh0dHBzOi8vJHtwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19WRVJDRUxfVVJMfWBcbiAgOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19CQVNFX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAyJztcbmNvbnN0IEdJVEhVQl9SRURJUkVDVF9VUkkgPSBwcm9jZXNzLmVudi5HSVRIVUJfUkVESVJFQ1RfVVJJIHx8IGAke2Jhc2VVcmx9L2FwaS9hdXRoL2dpdGh1Yi9jYWxsYmFja2A7XG5cbi8qKlxuICogR2VuZXJhdGUgR2l0SHViIE9BdXRoIGF1dGhvcml6YXRpb24gVVJMXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRHaXRIdWJBdXRoVXJsKCk6IHN0cmluZyB7XG4gIGlmICghR0lUSFVCX0NMSUVOVF9JRCkge1xuICAgIHRocm93IG5ldyBFcnJvcignR0lUSFVCX0NMSUVOVF9JRCBpcyBub3QgY29uZmlndXJlZC4gUGxlYXNlIGFkZCBpdCB0byAuZW52LmxvY2FsJyk7XG4gIH1cbiAgXG4gIGNvbnN0IHN0YXRlID0gcmFuZG9tQnl0ZXMoMTYpLnRvU3RyaW5nKCdoZXgnKTtcbiAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgY2xpZW50X2lkOiBHSVRIVUJfQ0xJRU5UX0lELFxuICAgIHJlZGlyZWN0X3VyaTogR0lUSFVCX1JFRElSRUNUX1VSSSxcbiAgICBzY29wZTogJ3JlYWQ6dXNlciB1c2VyOmVtYWlsJyxcbiAgICBzdGF0ZSxcbiAgfSk7XG4gIHJldHVybiBgaHR0cHM6Ly9naXRodWIuY29tL2xvZ2luL29hdXRoL2F1dGhvcml6ZT8ke3BhcmFtcy50b1N0cmluZygpfWA7XG59XG5cbi8qKlxuICogSGFuZGxlIEdpdEh1YiBPQXV0aCBjYWxsYmFja1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gaGFuZGxlR2l0SHViQ2FsbGJhY2soY29kZTogc3RyaW5nKTogUHJvbWlzZTx7IHVzZXI6IFVzZXI7IHNlc3Npb246IHsgdG9rZW46IHN0cmluZyB9IH0+IHtcbiAgLy8gRXhjaGFuZ2UgY29kZSBmb3IgYWNjZXNzIHRva2VuXG4gIGNvbnN0IHRva2VuUmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9naXRodWIuY29tL2xvZ2luL29hdXRoL2FjY2Vzc190b2tlbicsIHtcbiAgICBtZXRob2Q6ICdQT1NUJyxcbiAgICBoZWFkZXJzOiB7XG4gICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgfSxcbiAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICBjbGllbnRfaWQ6IEdJVEhVQl9DTElFTlRfSUQsXG4gICAgICBjbGllbnRfc2VjcmV0OiBHSVRIVUJfQ0xJRU5UX1NFQ1JFVCxcbiAgICAgIGNvZGUsXG4gICAgfSksXG4gIH0pO1xuXG4gIGNvbnN0IHRva2VuRGF0YSA9IGF3YWl0IHRva2VuUmVzcG9uc2UuanNvbigpO1xuICBcbiAgaWYgKCF0b2tlbkRhdGEuYWNjZXNzX3Rva2VuKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGYWlsZWQgdG8gZ2V0IGFjY2VzcyB0b2tlbiBmcm9tIEdpdEh1YicpO1xuICB9XG5cbiAgLy8gR2V0IHVzZXIgaW5mbyBmcm9tIEdpdEh1YlxuICBjb25zdCB1c2VyUmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS91c2VyJywge1xuICAgIGhlYWRlcnM6IHtcbiAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0b2tlbkRhdGEuYWNjZXNzX3Rva2VufWAsXG4gICAgICBBY2NlcHQ6ICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzK2pzb24nLFxuICAgIH0sXG4gIH0pO1xuXG4gIGNvbnN0IGdpdGh1YlVzZXIgPSBhd2FpdCB1c2VyUmVzcG9uc2UuanNvbigpO1xuXG4gIC8vIENyZWF0ZSBvciB1cGRhdGUgdXNlclxuICBjb25zdCB1c2VyID0gY3JlYXRlT3JHZXRVc2VyKCdnaXRodWInLCBnaXRodWJVc2VyLmlkLnRvU3RyaW5nKCksIHtcbiAgICB1c2VybmFtZTogZ2l0aHViVXNlci5sb2dpbixcbiAgICBlbWFpbDogZ2l0aHViVXNlci5lbWFpbCB8fCBudWxsLFxuICAgIGF2YXRhcl91cmw6IGdpdGh1YlVzZXIuYXZhdGFyX3VybCB8fCBudWxsLFxuICB9KTtcblxuICAvLyBDcmVhdGUgc2Vzc2lvblxuICBjb25zdCBzZXNzaW9uID0gY3JlYXRlU2Vzc2lvbih1c2VyLmlkLCBTRVNTSU9OX0RVUkFUSU9OX1NFQ09ORFMpO1xuXG4gIHJldHVybiB7XG4gICAgdXNlcixcbiAgICBzZXNzaW9uOiB7IHRva2VuOiBzZXNzaW9uLnRva2VuIH0sXG4gIH07XG59XG5cbi8qKlxuICogV2FsbGV0IEF1dGhlbnRpY2F0aW9uXG4gKi9cblxuLyoqXG4gKiBHZW5lcmF0ZSBtZXNzYWdlIGZvciB3YWxsZXQgc2lnbmF0dXJlXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZW5lcmF0ZVdhbGxldE1lc3NhZ2UoYWRkcmVzczogc3RyaW5nKTogc3RyaW5nIHtcbiAgY29uc3QgdGltZXN0YW1wID0gRGF0ZS5ub3coKTtcbiAgcmV0dXJuIGBTaWduIHRoaXMgbWVzc2FnZSB0byBhdXRoZW50aWNhdGUgd2l0aCBBa2hBSS5cXG5cXG5BZGRyZXNzOiAke2FkZHJlc3N9XFxuVGltZXN0YW1wOiAke3RpbWVzdGFtcH1gO1xufVxuXG4vKipcbiAqIFZlcmlmeSB3YWxsZXQgc2lnbmF0dXJlIChzaW1wbGlmaWVkIC0gaW4gcHJvZHVjdGlvbiwgdXNlIHByb3BlciBFSVAtMTkxIHZlcmlmaWNhdGlvbilcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIHZlcmlmeVdhbGxldFNpZ25hdHVyZShhZGRyZXNzOiBzdHJpbmcsIHNpZ25hdHVyZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgLy8gSW4gcHJvZHVjdGlvbiwgdXNlIGV0aGVycy5qcyBvciB3ZWIzLmpzIHRvIHByb3Blcmx5IHZlcmlmeSBFSVAtMTkxIHNpZ25hdHVyZXNcbiAgLy8gRm9yIG5vdywgdGhpcyBpcyBhIHBsYWNlaG9sZGVyIHRoYXQgYWNjZXB0cyBhbnkgc2lnbmF0dXJlXG4gIC8vIFRPRE86IEltcGxlbWVudCBwcm9wZXIgc2lnbmF0dXJlIHZlcmlmaWNhdGlvblxuICByZXR1cm4gdHJ1ZTtcbn1cblxuLyoqXG4gKiBBdXRoZW50aWNhdGUgd2l0aCB3YWxsZXRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGF1dGhlbnRpY2F0ZVdhbGxldChhZGRyZXNzOiBzdHJpbmcsIHNpZ25hdHVyZTogc3RyaW5nLCBtZXNzYWdlOiBzdHJpbmcpOiB7IHVzZXI6IFVzZXI7IHNlc3Npb246IHsgdG9rZW46IHN0cmluZyB9IH0ge1xuICAvLyBWZXJpZnkgc2lnbmF0dXJlXG4gIGlmICghdmVyaWZ5V2FsbGV0U2lnbmF0dXJlKGFkZHJlc3MsIHNpZ25hdHVyZSwgbWVzc2FnZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgd2FsbGV0IHNpZ25hdHVyZScpO1xuICB9XG5cbiAgLy8gQ3JlYXRlIG9yIGdldCB1c2VyXG4gIGNvbnN0IHVzZXIgPSBjcmVhdGVPckdldFVzZXIoJ3dhbGxldCcsIGFkZHJlc3MudG9Mb3dlckNhc2UoKSwge1xuICAgIHVzZXJuYW1lOiBgJHthZGRyZXNzLnNsaWNlKDAsIDYpfS4uLiR7YWRkcmVzcy5zbGljZSgtNCl9YCxcbiAgfSk7XG5cbiAgLy8gQ3JlYXRlIHNlc3Npb25cbiAgY29uc3Qgc2Vzc2lvbiA9IGNyZWF0ZVNlc3Npb24odXNlci5pZCwgU0VTU0lPTl9EVVJBVElPTl9TRUNPTkRTKTtcblxuICByZXR1cm4ge1xuICAgIHVzZXIsXG4gICAgc2Vzc2lvbjogeyB0b2tlbjogc2Vzc2lvbi50b2tlbiB9LFxuICB9O1xufVxuXG4vKipcbiAqIFNlc3Npb24gTWFuYWdlbWVudFxuICovXG5cbi8qKlxuICogR2V0IHVzZXIgZnJvbSBzZXNzaW9uIHRva2VuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyRnJvbVNlc3Npb24odG9rZW46IHN0cmluZyk6IFVzZXIgfCBudWxsIHtcbiAgcmV0dXJuIHZhbGlkYXRlU2Vzc2lvbih0b2tlbik7XG59XG5cbi8qKlxuICogTG9nb3V0IChkZXN0cm95IHNlc3Npb24pXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBsb2dvdXQodG9rZW46IHN0cmluZyk6IHZvaWQge1xuICBkZXN0cm95U2Vzc2lvbih0b2tlbik7XG59XG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVPckdldFVzZXIiLCJjcmVhdGVTZXNzaW9uIiwidmFsaWRhdGVTZXNzaW9uIiwiZGVzdHJveVNlc3Npb24iLCJyYW5kb21CeXRlcyIsIlNFU1NJT05fRFVSQVRJT05fU0VDT05EUyIsIkFETUlOX0dJVEhVQl9VU0VSTkFNRSIsInByb2Nlc3MiLCJlbnYiLCJpc0FkbWluIiwidXNlciIsImF1dGhfcHJvdmlkZXIiLCJ1c2VybmFtZSIsIkdJVEhVQl9DTElFTlRfSUQiLCJHSVRIVUJfQ0xJRU5UX1NFQ1JFVCIsImJhc2VVcmwiLCJORVhUX1BVQkxJQ19WRVJDRUxfVVJMIiwiTkVYVF9QVUJMSUNfQkFTRV9VUkwiLCJHSVRIVUJfUkVESVJFQ1RfVVJJIiwiZ2V0R2l0SHViQXV0aFVybCIsIkVycm9yIiwic3RhdGUiLCJ0b1N0cmluZyIsInBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsImNsaWVudF9pZCIsInJlZGlyZWN0X3VyaSIsInNjb3BlIiwiaGFuZGxlR2l0SHViQ2FsbGJhY2siLCJjb2RlIiwidG9rZW5SZXNwb25zZSIsImZldGNoIiwibWV0aG9kIiwiaGVhZGVycyIsIkFjY2VwdCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiY2xpZW50X3NlY3JldCIsInRva2VuRGF0YSIsImpzb24iLCJhY2Nlc3NfdG9rZW4iLCJ1c2VyUmVzcG9uc2UiLCJBdXRob3JpemF0aW9uIiwiZ2l0aHViVXNlciIsImlkIiwibG9naW4iLCJlbWFpbCIsImF2YXRhcl91cmwiLCJzZXNzaW9uIiwidG9rZW4iLCJnZW5lcmF0ZVdhbGxldE1lc3NhZ2UiLCJhZGRyZXNzIiwidGltZXN0YW1wIiwiRGF0ZSIsIm5vdyIsInZlcmlmeVdhbGxldFNpZ25hdHVyZSIsInNpZ25hdHVyZSIsIm1lc3NhZ2UiLCJhdXRoZW50aWNhdGVXYWxsZXQiLCJ0b0xvd2VyQ2FzZSIsInNsaWNlIiwiZ2V0VXNlckZyb21TZXNzaW9uIiwibG9nb3V0Il0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/database.ts":
/*!*************************!*\
  !*** ./lib/database.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   addEvent: () => (/* binding */ addEvent),\n/* harmony export */   cleanExpiredSessions: () => (/* binding */ cleanExpiredSessions),\n/* harmony export */   closeDatabase: () => (/* binding */ closeDatabase),\n/* harmony export */   createOrGetUser: () => (/* binding */ createOrGetUser),\n/* harmony export */   createQuery: () => (/* binding */ createQuery),\n/* harmony export */   createSession: () => (/* binding */ createSession),\n/* harmony export */   db: () => (/* binding */ db),\n/* harmony export */   destroySession: () => (/* binding */ destroySession),\n/* harmony export */   getEvents: () => (/* binding */ getEvents),\n/* harmony export */   getOrCreateAnonymousUser: () => (/* binding */ getOrCreateAnonymousUser),\n/* harmony export */   getQuery: () => (/* binding */ getQuery),\n/* harmony export */   getRecentQueries: () => (/* binding */ getRecentQueries),\n/* harmony export */   getStats: () => (/* binding */ getStats),\n/* harmony export */   getUser: () => (/* binding */ getUser),\n/* harmony export */   migrateAddUserIdColumns: () => (/* binding */ migrateAddUserIdColumns),\n/* harmony export */   trackUsage: () => (/* binding */ trackUsage),\n/* harmony export */   updateQuery: () => (/* binding */ updateQuery),\n/* harmony export */   validateSession: () => (/* binding */ validateSession)\n/* harmony export */ });\n/* harmony import */ var better_sqlite3__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! better-sqlite3 */ \"better-sqlite3\");\n/* harmony import */ var better_sqlite3__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(better_sqlite3__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\n/**\n * SQLite Database for AkhAI\n *\n * Provides persistent storage for queries, events, and usage statistics.\n */ \n\n\n// Ensure data directory exists\nconst dataDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), 'data');\nif (!fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(dataDir)) {\n    fs__WEBPACK_IMPORTED_MODULE_2___default().mkdirSync(dataDir, {\n        recursive: true\n    });\n}\nconst dbPath = path__WEBPACK_IMPORTED_MODULE_1___default().join(dataDir, 'akhai.db');\nconst db = new (better_sqlite3__WEBPACK_IMPORTED_MODULE_0___default())(dbPath);\n// Enable WAL mode for better concurrency\ndb.pragma('journal_mode = WAL');\n// Initialize database schema\ndb.exec(`\n  -- Users table\n  CREATE TABLE IF NOT EXISTS users (\n    id TEXT PRIMARY KEY,\n    username TEXT,\n    email TEXT,\n    avatar_url TEXT,\n    auth_provider TEXT NOT NULL,\n    auth_id TEXT NOT NULL,\n    created_at INTEGER DEFAULT (strftime('%s', 'now')),\n    updated_at INTEGER DEFAULT (strftime('%s', 'now')),\n    UNIQUE(auth_provider, auth_id)\n  );\n\n  -- Sessions table\n  CREATE TABLE IF NOT EXISTS sessions (\n    id TEXT PRIMARY KEY,\n    user_id TEXT NOT NULL,\n    token TEXT NOT NULL UNIQUE,\n    expires_at INTEGER NOT NULL,\n    created_at INTEGER DEFAULT (strftime('%s', 'now')),\n    FOREIGN KEY (user_id) REFERENCES users(id)\n  );\n\n  -- Queries table (with user_id support)\n  CREATE TABLE IF NOT EXISTS queries (\n    id TEXT PRIMARY KEY,\n    query TEXT NOT NULL,\n    flow TEXT NOT NULL,\n    status TEXT DEFAULT 'pending',\n    result TEXT,\n    tokens_used INTEGER DEFAULT 0,\n    cost REAL DEFAULT 0,\n    user_id TEXT,\n    created_at INTEGER DEFAULT (strftime('%s', 'now')),\n    completed_at INTEGER,\n    FOREIGN KEY (user_id) REFERENCES users(id)\n  );\n\n  CREATE TABLE IF NOT EXISTS events (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    query_id TEXT NOT NULL,\n    type TEXT NOT NULL,\n    data TEXT,\n    timestamp INTEGER DEFAULT (strftime('%s', 'now')),\n    FOREIGN KEY (query_id) REFERENCES queries(id)\n  );\n\n  CREATE TABLE IF NOT EXISTS usage (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    provider TEXT NOT NULL,\n    model TEXT NOT NULL,\n    input_tokens INTEGER NOT NULL,\n    output_tokens INTEGER NOT NULL,\n    cost REAL NOT NULL,\n    timestamp INTEGER DEFAULT (strftime('%s', 'now'))\n  );\n\n  -- Side Canal: Topics table\n  CREATE TABLE IF NOT EXISTS topics (\n    id TEXT PRIMARY KEY,\n    name TEXT NOT NULL,\n    description TEXT,\n    category TEXT,\n    user_id TEXT,\n    created_at INTEGER DEFAULT (strftime('%s', 'now')),\n    updated_at INTEGER DEFAULT (strftime('%s', 'now')),\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    UNIQUE(name, user_id)\n  );\n\n  -- Side Canal: Topic relationships\n  CREATE TABLE IF NOT EXISTS topic_relationships (\n    id INTEGER PRIMARY KEY AUTOINCREMENT,\n    topic_from TEXT NOT NULL,\n    topic_to TEXT NOT NULL,\n    relationship_type TEXT DEFAULT 'related',\n    strength REAL DEFAULT 1.0,\n    user_id TEXT,\n    created_at INTEGER DEFAULT (strftime('%s', 'now')),\n    FOREIGN KEY (topic_from) REFERENCES topics(id),\n    FOREIGN KEY (topic_to) REFERENCES topics(id),\n    FOREIGN KEY (user_id) REFERENCES users(id),\n    UNIQUE(topic_from, topic_to, relationship_type, user_id)\n  );\n\n  -- Side Canal: Query-Topic mapping\n  CREATE TABLE IF NOT EXISTS query_topics (\n    query_id TEXT NOT NULL,\n    topic_id TEXT NOT NULL,\n    relevance REAL DEFAULT 1.0,\n    created_at INTEGER DEFAULT (strftime('%s', 'now')),\n    PRIMARY KEY (query_id, topic_id),\n    FOREIGN KEY (query_id) REFERENCES queries(id),\n    FOREIGN KEY (topic_id) REFERENCES topics(id)\n  );\n\n  -- Side Canal: Synopses\n  CREATE TABLE IF NOT EXISTS synopses (\n    id TEXT PRIMARY KEY,\n    topic_id TEXT NOT NULL,\n    content TEXT NOT NULL,\n    query_ids TEXT NOT NULL,\n    user_id TEXT,\n    created_at INTEGER DEFAULT (strftime('%s', 'now')),\n    updated_at INTEGER DEFAULT (strftime('%s', 'now')),\n    FOREIGN KEY (topic_id) REFERENCES topics(id),\n    FOREIGN KEY (user_id) REFERENCES users(id)\n  );\n\n  -- Indexes\n  CREATE INDEX IF NOT EXISTS idx_queries_created_at ON queries(created_at DESC);\n  CREATE INDEX IF NOT EXISTS idx_queries_status ON queries(status);\n  -- Note: idx_queries_user_id will be created after migration\n  CREATE INDEX IF NOT EXISTS idx_events_query_id ON events(query_id);\n  CREATE INDEX IF NOT EXISTS idx_usage_provider ON usage(provider);\n  CREATE INDEX IF NOT EXISTS idx_usage_timestamp ON usage(timestamp);\n  CREATE INDEX IF NOT EXISTS idx_topics_user_id ON topics(user_id);\n  CREATE INDEX IF NOT EXISTS idx_topics_name ON topics(name);\n  CREATE INDEX IF NOT EXISTS idx_sessions_token ON sessions(token);\n  CREATE INDEX IF NOT EXISTS idx_sessions_user_id ON sessions(user_id);\n  CREATE INDEX IF NOT EXISTS idx_sessions_expires_at ON sessions(expires_at);\n`);\nconsole.log(` Database initialized: ${dbPath}`);\n\n/**\n * Create a new query\n */ function createQuery(id, query, flow, userId) {\n    const stmt = db.prepare('INSERT INTO queries (id, query, flow, user_id) VALUES (?, ?, ?, ?)');\n    stmt.run(id, query, flow, userId || null);\n}\n/**\n * Update query details\n */ function updateQuery(id, updates, userId) {\n    const fields = Object.keys(updates);\n    if (fields.length === 0) return;\n    const sets = fields.map((f)=>`${f} = ?`).join(', ');\n    const values = fields.map((f)=>updates[f]);\n    const stmt = db.prepare(`UPDATE queries SET ${sets}, completed_at = strftime('%s', 'now') WHERE id = ? AND user_id = ?`);\n    stmt.run(...values, id, userId);\n}\n/**\n * Get a query by ID (optionally scoped to user)\n */ function getQuery(id, userId) {\n    if (userId) {\n        const stmt = db.prepare('SELECT * FROM queries WHERE id = ? AND user_id = ?');\n        return stmt.get(id, userId);\n    }\n    const stmt = db.prepare('SELECT * FROM queries WHERE id = ?');\n    return stmt.get(id);\n}\n/**\n * Add an event to a query\n */ function addEvent(queryId, type, data) {\n    const stmt = db.prepare('INSERT INTO events (query_id, type, data) VALUES (?, ?, ?)');\n    stmt.run(queryId, type, JSON.stringify(data));\n}\n/**\n * Get events for a query\n */ function getEvents(queryId, offset = 0) {\n    const stmt = db.prepare('SELECT * FROM events WHERE query_id = ? ORDER BY id ASC LIMIT -1 OFFSET ?');\n    return stmt.all(queryId, offset);\n}\n/**\n * Track API usage\n */ function trackUsage(provider, model, inputTokens, outputTokens, cost) {\n    const stmt = db.prepare('INSERT INTO usage (provider, model, input_tokens, output_tokens, cost) VALUES (?, ?, ?, ?, ?)');\n    stmt.run(provider, model, inputTokens, outputTokens, cost);\n}\n/**\n * Get dashboard statistics (optionally scoped to user)\n */ function getStats(userId) {\n    const now = Math.floor(Date.now() / 1000);\n    const todayStart = now - now % 86400;\n    // Start of current month\n    const date = new Date();\n    const monthStart = Math.floor(new Date(date.getFullYear(), date.getMonth(), 1).getTime() / 1000);\n    const userFilter = userId ? 'AND user_id = ?' : '';\n    const userParams = userId ? [\n        userId\n    ] : [];\n    const queriesToday = db.prepare(`SELECT COUNT(*) as count FROM queries WHERE created_at >= ? ${userFilter}`).get(...userId ? [\n        todayStart,\n        userId\n    ] : [\n        todayStart\n    ]);\n    const queriesMonth = db.prepare(`SELECT COUNT(*) as count FROM queries WHERE created_at >= ? ${userFilter}`).get(...userId ? [\n        monthStart,\n        userId\n    ] : [\n        monthStart\n    ]);\n    const totals = db.prepare(`SELECT SUM(tokens_used) as tokens, SUM(cost) as cost FROM queries ${userId ? 'WHERE user_id = ?' : ''}`).get(...userParams);\n    const avgTime = db.prepare(`SELECT AVG(completed_at - created_at) as avg FROM queries WHERE status = 'complete' AND completed_at IS NOT NULL ${userFilter}`).get(...userParams);\n    const providerStats = db.prepare(`SELECT provider, COUNT(*) as queries, SUM(cost) as cost\n       FROM usage\n       GROUP BY provider`).all();\n    return {\n        queriesToday: queriesToday?.count || 0,\n        queriesThisMonth: queriesMonth?.count || 0,\n        totalTokens: totals?.tokens || 0,\n        totalCost: totals?.cost || 0,\n        avgResponseTime: avgTime?.avg || 0,\n        providerStats\n    };\n}\n/**\n * Get recent queries (optionally scoped to user)\n */ function getRecentQueries(limit = 10, userId) {\n    if (userId) {\n        const stmt = db.prepare(`\n      SELECT id, query, flow, status, created_at, completed_at\n      FROM queries\n      WHERE user_id = ?\n      ORDER BY created_at DESC\n      LIMIT ?\n    `);\n        return stmt.all(userId, limit);\n    }\n    const stmt = db.prepare(`\n    SELECT id, query, flow, status, created_at, completed_at\n    FROM queries\n    ORDER BY created_at DESC\n    LIMIT ?\n  `);\n    return stmt.all(limit);\n}\n/**\n * Close database connection (for graceful shutdown)\n */ function closeDatabase() {\n    db.close();\n    console.log('Database connection closed');\n}\n/**\n * Migration: Add user_id columns to existing tables if they don't exist\n * SQLite doesn't support ALTER TABLE ADD COLUMN IF NOT EXISTS, so we check first\n */ function migrateAddUserIdColumns() {\n    try {\n        console.log('[DEBUG] Starting migration: migrateAddUserIdColumns');\n        // Check if user_id column exists in queries table\n        const queriesInfo = db.prepare(\"PRAGMA table_info(queries)\").all();\n        const hasUserIdInQueries = queriesInfo.some((col)=>col.name === 'user_id');\n        console.log('[DEBUG] Queries table columns:', queriesInfo.map((c)=>c.name), 'hasUserId:', hasUserIdInQueries);\n        if (!hasUserIdInQueries) {\n            console.log('[DEBUG] Adding user_id column to queries table');\n            db.exec('ALTER TABLE queries ADD COLUMN user_id TEXT');\n            db.exec('CREATE INDEX IF NOT EXISTS idx_queries_user_id ON queries(user_id)');\n            console.log(' Added user_id column to queries table');\n        } else {\n            console.log('[DEBUG] user_id column already exists in queries table');\n        }\n        // Check if user_id column exists in topics table (will be created if table doesn't exist)\n        const topicsInfo = db.prepare(\"PRAGMA table_info(topics)\").all();\n        const hasUserIdInTopics = topicsInfo.some((col)=>col.name === 'user_id');\n        if (topicsInfo.length > 0 && !hasUserIdInTopics) {\n            console.log('[DEBUG] Adding user_id column to topics table');\n            db.exec('ALTER TABLE topics ADD COLUMN user_id TEXT');\n            console.log(' Added user_id column to topics table');\n        } else {\n            console.log('[DEBUG] Topics table check - table exists:', topicsInfo.length > 0, 'hasUserId:', topicsInfo.length > 0 ? hasUserIdInTopics : 'N/A (table does not exist)');\n        }\n    } catch (error) {\n        const errorInfo = {\n            message: error instanceof Error ? error.message : String(error),\n            name: error instanceof Error ? error.name : 'Unknown',\n            code: error?.code || 'no code',\n            stack: error instanceof Error ? error.stack?.substring(0, 300) : 'no stack'\n        };\n        console.error('[DEBUG] Migration error:', errorInfo);\n        throw error; // Re-throw to prevent silent failures\n    }\n}\n// Run migration on module load (after schema initialization)\ntry {\n    console.log('[DEBUG] Running migration on module load');\n    migrateAddUserIdColumns();\n    console.log('[DEBUG] Migration completed successfully');\n} catch (error) {\n    console.error('[DEBUG] Failed to run migration on module load:', error);\n// Don't throw - allow app to start but log the error\n}\n/**\n * Create or get user by auth provider and ID\n */ function createOrGetUser(authProvider, authId, userData) {\n    // Check if user exists\n    const existing = db.prepare('SELECT * FROM users WHERE auth_provider = ? AND auth_id = ?').get(authProvider, authId);\n    if (existing) {\n        // Update if new data provided\n        if (userData && (userData.username || userData.email || userData.avatar_url)) {\n            const updates = [];\n            const values = [];\n            if (userData.username !== undefined) {\n                updates.push('username = ?');\n                values.push(userData.username);\n            }\n            if (userData.email !== undefined) {\n                updates.push('email = ?');\n                values.push(userData.email);\n            }\n            if (userData.avatar_url !== undefined) {\n                updates.push('avatar_url = ?');\n                values.push(userData.avatar_url);\n            }\n            if (updates.length > 0) {\n                updates.push('updated_at = strftime(\\'%s\\', \\'now\\')');\n                values.push(existing.id);\n                db.prepare(`UPDATE users SET ${updates.join(', ')} WHERE id = ?`).run(...values);\n                return db.prepare('SELECT * FROM users WHERE id = ?').get(existing.id);\n            }\n        }\n        return existing;\n    }\n    // Create new user\n    const userId = Math.random().toString(36).substring(2, 15);\n    db.prepare(`\n    INSERT INTO users (id, username, email, avatar_url, auth_provider, auth_id)\n    VALUES (?, ?, ?, ?, ?, ?)\n  `).run(userId, userData?.username || null, userData?.email || null, userData?.avatar_url || null, authProvider, authId);\n    return db.prepare('SELECT * FROM users WHERE id = ?').get(userId);\n}\n/**\n * Get user by ID\n */ function getUser(userId) {\n    return db.prepare('SELECT * FROM users WHERE id = ?').get(userId);\n}\n/**\n * Get anonymous user (for migration)\n */ function getOrCreateAnonymousUser() {\n    const anonymous = db.prepare('SELECT * FROM users WHERE auth_provider = ? AND auth_id = ?').get('wallet', 'anonymous');\n    if (anonymous) {\n        return anonymous;\n    }\n    return createOrGetUser('wallet', 'anonymous', {\n        username: 'Anonymous'\n    });\n}\n/**\n * Create a new session\n */ function createSession(userId, expiresInSeconds = 30 * 24 * 60 * 60) {\n    const sessionId = Math.random().toString(36).substring(2, 15);\n    const token = Math.random().toString(36).substring(2, 30) + Date.now().toString(36);\n    const expiresAt = Math.floor(Date.now() / 1000) + expiresInSeconds;\n    db.prepare(`\n    INSERT INTO sessions (id, user_id, token, expires_at)\n    VALUES (?, ?, ?, ?)\n  `).run(sessionId, userId, token, expiresAt);\n    return db.prepare('SELECT * FROM sessions WHERE id = ?').get(sessionId);\n}\n/**\n * Validate session token and return user\n */ function validateSession(token) {\n    console.log('[DEBUG] validateSession entry, token:', token.substring(0, 10));\n    // #region agent log\n    try {\n        fetch('http://127.0.0.1:7242/ingest/3a942698-b8f2-4482-824a-ac082ba88036', {\n            method: 'POST',\n            headers: {\n                'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n                location: 'lib/database.ts:492',\n                message: 'validateSession entry',\n                data: {\n                    token: token.substring(0, 10)\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'run1',\n                hypothesisId: 'B'\n            })\n        }).catch(()=>{});\n    } catch (e) {}\n    // #endregion\n    try {\n        console.log('[DEBUG] Before SQL query');\n        // #region agent log\n        try {\n            fetch('http://127.0.0.1:7242/ingest/3a942698-b8f2-4482-824a-ac082ba88036', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    location: 'lib/database.ts:495',\n                    message: 'Before SQL query',\n                    data: {},\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'run1',\n                    hypothesisId: 'D'\n                })\n            }).catch(()=>{});\n        } catch (e) {}\n        // #endregion\n        // Check if tables exist\n        const tablesCheck = db.prepare(`\n      SELECT name FROM sqlite_master \n      WHERE type='table' AND (name='users' OR name='sessions')\n    `).all();\n        console.log('[DEBUG] Tables check:', tablesCheck.map((t)=>t.name), 'hasUsers:', !!tablesCheck.find((t)=>t.name === 'users'), 'hasSessions:', !!tablesCheck.find((t)=>t.name === 'sessions'));\n        // #region agent log\n        try {\n            fetch('http://127.0.0.1:7242/ingest/3a942698-b8f2-4482-824a-ac082ba88036', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    location: 'lib/database.ts:502',\n                    message: 'Tables check',\n                    data: {\n                        tablesFound: tablesCheck.map((t)=>t.name),\n                        hasUsers: !!tablesCheck.find((t)=>t.name === 'users'),\n                        hasSessions: !!tablesCheck.find((t)=>t.name === 'sessions')\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'run1',\n                    hypothesisId: 'C'\n                })\n            }).catch(()=>{});\n        } catch (e) {}\n        // #endregion\n        console.log('[DEBUG] Executing SQL query with token');\n        let session;\n        try {\n            session = db.prepare(`\n        SELECT s.id as session_id, s.user_id, s.token, s.expires_at, s.created_at as session_created_at,\n               u.id, u.username, u.email, u.avatar_url, u.auth_provider, u.auth_id, u.created_at, u.updated_at\n        FROM sessions s\n        JOIN users u ON s.user_id = u.id\n        WHERE s.token = ? AND s.expires_at > strftime('%s', 'now')\n      `).get(token);\n        } catch (sqlError) {\n            console.error('[DEBUG] SQL query error:', sqlError);\n            throw sqlError;\n        }\n        console.log('[DEBUG] After SQL query, hasSession:', !!session, 'userId:', session?.id || null);\n        // #region agent log\n        try {\n            fetch('http://127.0.0.1:7242/ingest/3a942698-b8f2-4482-824a-ac082ba88036', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    location: 'lib/database.ts:520',\n                    message: 'After SQL query',\n                    data: {\n                        hasSession: !!session,\n                        userId: session?.id || null\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'run1',\n                    hypothesisId: 'B'\n                })\n            }).catch(()=>{});\n        } catch (e) {}\n        // #endregion\n        if (!session) {\n            return null;\n        }\n        return {\n            id: session.id,\n            username: session.username,\n            email: session.email,\n            avatar_url: session.avatar_url,\n            auth_provider: session.auth_provider,\n            auth_id: session.auth_id,\n            created_at: session.created_at,\n            updated_at: session.updated_at\n        };\n    } catch (error) {\n        const errorInfo = {\n            message: error instanceof Error ? error.message : String(error),\n            name: error instanceof Error ? error.name : 'Unknown',\n            code: error?.code || 'no code',\n            stack: error instanceof Error ? error.stack?.substring(0, 300) : 'no stack'\n        };\n        console.error('[DEBUG] validateSession error:', errorInfo);\n        // #region agent log\n        try {\n            fetch('http://127.0.0.1:7242/ingest/3a942698-b8f2-4482-824a-ac082ba88036', {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json'\n                },\n                body: JSON.stringify({\n                    location: 'lib/database.ts:540',\n                    message: 'validateSession error',\n                    data: errorInfo,\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'run1',\n                    hypothesisId: 'C'\n                })\n            }).catch(()=>{});\n        } catch (e) {}\n        // #endregion\n        throw error;\n    }\n}\n/**\n * Destroy session (logout)\n */ function destroySession(token) {\n    db.prepare('DELETE FROM sessions WHERE token = ?').run(token);\n}\n/**\n * Clean expired sessions\n */ function cleanExpiredSessions() {\n    db.prepare('DELETE FROM sessions WHERE expires_at <= strftime(\\'%s\\', \\'now\\')').run();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YixNQUFNdEM7SUFDUjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxTQUFTb0QsZUFBZTFCLEtBQWE7SUFDMUN4RyxHQUFHVyxPQUFPLENBQUMsd0NBQXdDQyxHQUFHLENBQUM0RjtBQUN6RDtBQUVBOztDQUVDLEdBQ00sU0FBUzJCO0lBQ2RuSSxHQUFHVyxPQUFPLENBQUMsc0VBQXNFQyxHQUFHO0FBQ3RGIiwic291cmNlcyI6WyIvVXNlcnMvc2hlaXJyYXphL2FraGFpL3BhY2thZ2VzL3dlYi9saWIvZGF0YWJhc2UudHMiXSwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBTUUxpdGUgRGF0YWJhc2UgZm9yIEFraEFJXG4gKlxuICogUHJvdmlkZXMgcGVyc2lzdGVudCBzdG9yYWdlIGZvciBxdWVyaWVzLCBldmVudHMsIGFuZCB1c2FnZSBzdGF0aXN0aWNzLlxuICovXG5cbmltcG9ydCBEYXRhYmFzZSBmcm9tICdiZXR0ZXItc3FsaXRlMyc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcbmltcG9ydCBmcyBmcm9tICdmcyc7XG5cbi8vIEVuc3VyZSBkYXRhIGRpcmVjdG9yeSBleGlzdHNcbmNvbnN0IGRhdGFEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ2RhdGEnKTtcbmlmICghZnMuZXhpc3RzU3luYyhkYXRhRGlyKSkge1xuICBmcy5ta2RpclN5bmMoZGF0YURpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XG59XG5cbmNvbnN0IGRiUGF0aCA9IHBhdGguam9pbihkYXRhRGlyLCAnYWtoYWkuZGInKTtcbmNvbnN0IGRiID0gbmV3IERhdGFiYXNlKGRiUGF0aCk7XG5cbi8vIEVuYWJsZSBXQUwgbW9kZSBmb3IgYmV0dGVyIGNvbmN1cnJlbmN5XG5kYi5wcmFnbWEoJ2pvdXJuYWxfbW9kZSA9IFdBTCcpO1xuXG4vLyBJbml0aWFsaXplIGRhdGFiYXNlIHNjaGVtYVxuZGIuZXhlYyhgXG4gIC0tIFVzZXJzIHRhYmxlXG4gIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHVzZXJzIChcbiAgICBpZCBURVhUIFBSSU1BUlkgS0VZLFxuICAgIHVzZXJuYW1lIFRFWFQsXG4gICAgZW1haWwgVEVYVCxcbiAgICBhdmF0YXJfdXJsIFRFWFQsXG4gICAgYXV0aF9wcm92aWRlciBURVhUIE5PVCBOVUxMLFxuICAgIGF1dGhfaWQgVEVYVCBOT1QgTlVMTCxcbiAgICBjcmVhdGVkX2F0IElOVEVHRVIgREVGQVVMVCAoc3RyZnRpbWUoJyVzJywgJ25vdycpKSxcbiAgICB1cGRhdGVkX2F0IElOVEVHRVIgREVGQVVMVCAoc3RyZnRpbWUoJyVzJywgJ25vdycpKSxcbiAgICBVTklRVUUoYXV0aF9wcm92aWRlciwgYXV0aF9pZClcbiAgKTtcblxuICAtLSBTZXNzaW9ucyB0YWJsZVxuICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBzZXNzaW9ucyAoXG4gICAgaWQgVEVYVCBQUklNQVJZIEtFWSxcbiAgICB1c2VyX2lkIFRFWFQgTk9UIE5VTEwsXG4gICAgdG9rZW4gVEVYVCBOT1QgTlVMTCBVTklRVUUsXG4gICAgZXhwaXJlc19hdCBJTlRFR0VSIE5PVCBOVUxMLFxuICAgIGNyZWF0ZWRfYXQgSU5URUdFUiBERUZBVUxUIChzdHJmdGltZSgnJXMnLCAnbm93JykpLFxuICAgIEZPUkVJR04gS0VZICh1c2VyX2lkKSBSRUZFUkVOQ0VTIHVzZXJzKGlkKVxuICApO1xuXG4gIC0tIFF1ZXJpZXMgdGFibGUgKHdpdGggdXNlcl9pZCBzdXBwb3J0KVxuICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyBxdWVyaWVzIChcbiAgICBpZCBURVhUIFBSSU1BUlkgS0VZLFxuICAgIHF1ZXJ5IFRFWFQgTk9UIE5VTEwsXG4gICAgZmxvdyBURVhUIE5PVCBOVUxMLFxuICAgIHN0YXR1cyBURVhUIERFRkFVTFQgJ3BlbmRpbmcnLFxuICAgIHJlc3VsdCBURVhULFxuICAgIHRva2Vuc191c2VkIElOVEVHRVIgREVGQVVMVCAwLFxuICAgIGNvc3QgUkVBTCBERUZBVUxUIDAsXG4gICAgdXNlcl9pZCBURVhULFxuICAgIGNyZWF0ZWRfYXQgSU5URUdFUiBERUZBVUxUIChzdHJmdGltZSgnJXMnLCAnbm93JykpLFxuICAgIGNvbXBsZXRlZF9hdCBJTlRFR0VSLFxuICAgIEZPUkVJR04gS0VZICh1c2VyX2lkKSBSRUZFUkVOQ0VTIHVzZXJzKGlkKVxuICApO1xuXG4gIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGV2ZW50cyAoXG4gICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgIHF1ZXJ5X2lkIFRFWFQgTk9UIE5VTEwsXG4gICAgdHlwZSBURVhUIE5PVCBOVUxMLFxuICAgIGRhdGEgVEVYVCxcbiAgICB0aW1lc3RhbXAgSU5URUdFUiBERUZBVUxUIChzdHJmdGltZSgnJXMnLCAnbm93JykpLFxuICAgIEZPUkVJR04gS0VZIChxdWVyeV9pZCkgUkVGRVJFTkNFUyBxdWVyaWVzKGlkKVxuICApO1xuXG4gIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHVzYWdlIChcbiAgICBpZCBJTlRFR0VSIFBSSU1BUlkgS0VZIEFVVE9JTkNSRU1FTlQsXG4gICAgcHJvdmlkZXIgVEVYVCBOT1QgTlVMTCxcbiAgICBtb2RlbCBURVhUIE5PVCBOVUxMLFxuICAgIGlucHV0X3Rva2VucyBJTlRFR0VSIE5PVCBOVUxMLFxuICAgIG91dHB1dF90b2tlbnMgSU5URUdFUiBOT1QgTlVMTCxcbiAgICBjb3N0IFJFQUwgTk9UIE5VTEwsXG4gICAgdGltZXN0YW1wIElOVEVHRVIgREVGQVVMVCAoc3RyZnRpbWUoJyVzJywgJ25vdycpKVxuICApO1xuXG4gIC0tIFNpZGUgQ2FuYWw6IFRvcGljcyB0YWJsZVxuICBDUkVBVEUgVEFCTEUgSUYgTk9UIEVYSVNUUyB0b3BpY3MgKFxuICAgIGlkIFRFWFQgUFJJTUFSWSBLRVksXG4gICAgbmFtZSBURVhUIE5PVCBOVUxMLFxuICAgIGRlc2NyaXB0aW9uIFRFWFQsXG4gICAgY2F0ZWdvcnkgVEVYVCxcbiAgICB1c2VyX2lkIFRFWFQsXG4gICAgY3JlYXRlZF9hdCBJTlRFR0VSIERFRkFVTFQgKHN0cmZ0aW1lKCclcycsICdub3cnKSksXG4gICAgdXBkYXRlZF9hdCBJTlRFR0VSIERFRkFVTFQgKHN0cmZ0aW1lKCclcycsICdub3cnKSksXG4gICAgRk9SRUlHTiBLRVkgKHVzZXJfaWQpIFJFRkVSRU5DRVMgdXNlcnMoaWQpLFxuICAgIFVOSVFVRShuYW1lLCB1c2VyX2lkKVxuICApO1xuXG4gIC0tIFNpZGUgQ2FuYWw6IFRvcGljIHJlbGF0aW9uc2hpcHNcbiAgQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdG9waWNfcmVsYXRpb25zaGlwcyAoXG4gICAgaWQgSU5URUdFUiBQUklNQVJZIEtFWSBBVVRPSU5DUkVNRU5ULFxuICAgIHRvcGljX2Zyb20gVEVYVCBOT1QgTlVMTCxcbiAgICB0b3BpY190byBURVhUIE5PVCBOVUxMLFxuICAgIHJlbGF0aW9uc2hpcF90eXBlIFRFWFQgREVGQVVMVCAncmVsYXRlZCcsXG4gICAgc3RyZW5ndGggUkVBTCBERUZBVUxUIDEuMCxcbiAgICB1c2VyX2lkIFRFWFQsXG4gICAgY3JlYXRlZF9hdCBJTlRFR0VSIERFRkFVTFQgKHN0cmZ0aW1lKCclcycsICdub3cnKSksXG4gICAgRk9SRUlHTiBLRVkgKHRvcGljX2Zyb20pIFJFRkVSRU5DRVMgdG9waWNzKGlkKSxcbiAgICBGT1JFSUdOIEtFWSAodG9waWNfdG8pIFJFRkVSRU5DRVMgdG9waWNzKGlkKSxcbiAgICBGT1JFSUdOIEtFWSAodXNlcl9pZCkgUkVGRVJFTkNFUyB1c2VycyhpZCksXG4gICAgVU5JUVVFKHRvcGljX2Zyb20sIHRvcGljX3RvLCByZWxhdGlvbnNoaXBfdHlwZSwgdXNlcl9pZClcbiAgKTtcblxuICAtLSBTaWRlIENhbmFsOiBRdWVyeS1Ub3BpYyBtYXBwaW5nXG4gIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHF1ZXJ5X3RvcGljcyAoXG4gICAgcXVlcnlfaWQgVEVYVCBOT1QgTlVMTCxcbiAgICB0b3BpY19pZCBURVhUIE5PVCBOVUxMLFxuICAgIHJlbGV2YW5jZSBSRUFMIERFRkFVTFQgMS4wLFxuICAgIGNyZWF0ZWRfYXQgSU5URUdFUiBERUZBVUxUIChzdHJmdGltZSgnJXMnLCAnbm93JykpLFxuICAgIFBSSU1BUlkgS0VZIChxdWVyeV9pZCwgdG9waWNfaWQpLFxuICAgIEZPUkVJR04gS0VZIChxdWVyeV9pZCkgUkVGRVJFTkNFUyBxdWVyaWVzKGlkKSxcbiAgICBGT1JFSUdOIEtFWSAodG9waWNfaWQpIFJFRkVSRU5DRVMgdG9waWNzKGlkKVxuICApO1xuXG4gIC0tIFNpZGUgQ2FuYWw6IFN5bm9wc2VzXG4gIENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIHN5bm9wc2VzIChcbiAgICBpZCBURVhUIFBSSU1BUlkgS0VZLFxuICAgIHRvcGljX2lkIFRFWFQgTk9UIE5VTEwsXG4gICAgY29udGVudCBURVhUIE5PVCBOVUxMLFxuICAgIHF1ZXJ5X2lkcyBURVhUIE5PVCBOVUxMLFxuICAgIHVzZXJfaWQgVEVYVCxcbiAgICBjcmVhdGVkX2F0IElOVEVHRVIgREVGQVVMVCAoc3RyZnRpbWUoJyVzJywgJ25vdycpKSxcbiAgICB1cGRhdGVkX2F0IElOVEVHRVIgREVGQVVMVCAoc3RyZnRpbWUoJyVzJywgJ25vdycpKSxcbiAgICBGT1JFSUdOIEtFWSAodG9waWNfaWQpIFJFRkVSRU5DRVMgdG9waWNzKGlkKSxcbiAgICBGT1JFSUdOIEtFWSAodXNlcl9pZCkgUkVGRVJFTkNFUyB1c2VycyhpZClcbiAgKTtcblxuICAtLSBJbmRleGVzXG4gIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9xdWVyaWVzX2NyZWF0ZWRfYXQgT04gcXVlcmllcyhjcmVhdGVkX2F0IERFU0MpO1xuICBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfcXVlcmllc19zdGF0dXMgT04gcXVlcmllcyhzdGF0dXMpO1xuICAtLSBOb3RlOiBpZHhfcXVlcmllc191c2VyX2lkIHdpbGwgYmUgY3JlYXRlZCBhZnRlciBtaWdyYXRpb25cbiAgQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X2V2ZW50c19xdWVyeV9pZCBPTiBldmVudHMocXVlcnlfaWQpO1xuICBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfdXNhZ2VfcHJvdmlkZXIgT04gdXNhZ2UocHJvdmlkZXIpO1xuICBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfdXNhZ2VfdGltZXN0YW1wIE9OIHVzYWdlKHRpbWVzdGFtcCk7XG4gIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF90b3BpY3NfdXNlcl9pZCBPTiB0b3BpY3ModXNlcl9pZCk7XG4gIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF90b3BpY3NfbmFtZSBPTiB0b3BpY3MobmFtZSk7XG4gIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9zZXNzaW9uc190b2tlbiBPTiBzZXNzaW9ucyh0b2tlbik7XG4gIENSRUFURSBJTkRFWCBJRiBOT1QgRVhJU1RTIGlkeF9zZXNzaW9uc191c2VyX2lkIE9OIHNlc3Npb25zKHVzZXJfaWQpO1xuICBDUkVBVEUgSU5ERVggSUYgTk9UIEVYSVNUUyBpZHhfc2Vzc2lvbnNfZXhwaXJlc19hdCBPTiBzZXNzaW9ucyhleHBpcmVzX2F0KTtcbmApO1xuXG5jb25zb2xlLmxvZyhg4pyFIERhdGFiYXNlIGluaXRpYWxpemVkOiAke2RiUGF0aH1gKTtcblxuZXhwb3J0IHsgZGIgfTtcblxuLyoqXG4gKiBDcmVhdGUgYSBuZXcgcXVlcnlcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVF1ZXJ5KGlkOiBzdHJpbmcsIHF1ZXJ5OiBzdHJpbmcsIGZsb3c6IHN0cmluZywgdXNlcklkPzogc3RyaW5nIHwgbnVsbCkge1xuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZSgnSU5TRVJUIElOVE8gcXVlcmllcyAoaWQsIHF1ZXJ5LCBmbG93LCB1c2VyX2lkKSBWQUxVRVMgKD8sID8sID8sID8pJyk7XG4gIHN0bXQucnVuKGlkLCBxdWVyeSwgZmxvdywgdXNlcklkIHx8IG51bGwpO1xufVxuXG4vKipcbiAqIFVwZGF0ZSBxdWVyeSBkZXRhaWxzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB1cGRhdGVRdWVyeShcbiAgaWQ6IHN0cmluZyxcbiAgdXBkYXRlczoge1xuICAgIHN0YXR1cz86IHN0cmluZztcbiAgICByZXN1bHQ/OiBzdHJpbmc7XG4gICAgdG9rZW5zX3VzZWQ/OiBudW1iZXI7XG4gICAgY29zdD86IG51bWJlcjtcbiAgfSxcbiAgdXNlcklkOiBzdHJpbmcgfCBudWxsXG4pIHtcbiAgY29uc3QgZmllbGRzID0gT2JqZWN0LmtleXModXBkYXRlcyk7XG4gIGlmIChmaWVsZHMubGVuZ3RoID09PSAwKSByZXR1cm47XG5cbiAgY29uc3Qgc2V0cyA9IGZpZWxkcy5tYXAoKGYpID0+IGAke2Z9ID0gP2ApLmpvaW4oJywgJyk7XG4gIGNvbnN0IHZhbHVlcyA9IGZpZWxkcy5tYXAoKGYpID0+IHVwZGF0ZXNbZiBhcyBrZXlvZiB0eXBlb2YgdXBkYXRlc10pO1xuXG4gIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKFxuICAgIGBVUERBVEUgcXVlcmllcyBTRVQgJHtzZXRzfSwgY29tcGxldGVkX2F0ID0gc3RyZnRpbWUoJyVzJywgJ25vdycpIFdIRVJFIGlkID0gPyBBTkQgdXNlcl9pZCA9ID9gXG4gICk7XG4gIHN0bXQucnVuKC4uLnZhbHVlcywgaWQsIHVzZXJJZCk7XG59XG5cbi8qKlxuICogR2V0IGEgcXVlcnkgYnkgSUQgKG9wdGlvbmFsbHkgc2NvcGVkIHRvIHVzZXIpXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRRdWVyeShpZDogc3RyaW5nLCB1c2VySWQ/OiBzdHJpbmcgfCBudWxsKSB7XG4gIGlmICh1c2VySWQpIHtcbiAgICBjb25zdCBzdG10ID0gZGIucHJlcGFyZSgnU0VMRUNUICogRlJPTSBxdWVyaWVzIFdIRVJFIGlkID0gPyBBTkQgdXNlcl9pZCA9ID8nKTtcbiAgICByZXR1cm4gc3RtdC5nZXQoaWQsIHVzZXJJZCk7XG4gIH1cbiAgY29uc3Qgc3RtdCA9IGRiLnByZXBhcmUoJ1NFTEVDVCAqIEZST00gcXVlcmllcyBXSEVSRSBpZCA9ID8nKTtcbiAgcmV0dXJuIHN0bXQuZ2V0KGlkKTtcbn1cblxuLyoqXG4gKiBBZGQgYW4gZXZlbnQgdG8gYSBxdWVyeVxuICovXG5leHBvcnQgZnVuY3Rpb24gYWRkRXZlbnQocXVlcnlJZDogc3RyaW5nLCB0eXBlOiBzdHJpbmcsIGRhdGE6IGFueSkge1xuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZSgnSU5TRVJUIElOVE8gZXZlbnRzIChxdWVyeV9pZCwgdHlwZSwgZGF0YSkgVkFMVUVTICg/LCA/LCA/KScpO1xuICBzdG10LnJ1bihxdWVyeUlkLCB0eXBlLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG59XG5cbi8qKlxuICogR2V0IGV2ZW50cyBmb3IgYSBxdWVyeVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0RXZlbnRzKHF1ZXJ5SWQ6IHN0cmluZywgb2Zmc2V0OiBudW1iZXIgPSAwKSB7XG4gIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKFxuICAgICdTRUxFQ1QgKiBGUk9NIGV2ZW50cyBXSEVSRSBxdWVyeV9pZCA9ID8gT1JERVIgQlkgaWQgQVNDIExJTUlUIC0xIE9GRlNFVCA/J1xuICApO1xuICByZXR1cm4gc3RtdC5hbGwocXVlcnlJZCwgb2Zmc2V0KSBhcyBBcnJheTx7XG4gICAgaWQ6IG51bWJlcjtcbiAgICBxdWVyeV9pZDogc3RyaW5nO1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBkYXRhOiBzdHJpbmc7XG4gICAgdGltZXN0YW1wOiBudW1iZXI7XG4gIH0+O1xufVxuXG4vKipcbiAqIFRyYWNrIEFQSSB1c2FnZVxuICovXG5leHBvcnQgZnVuY3Rpb24gdHJhY2tVc2FnZShcbiAgcHJvdmlkZXI6IHN0cmluZyxcbiAgbW9kZWw6IHN0cmluZyxcbiAgaW5wdXRUb2tlbnM6IG51bWJlcixcbiAgb3V0cHV0VG9rZW5zOiBudW1iZXIsXG4gIGNvc3Q6IG51bWJlclxuKSB7XG4gIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKFxuICAgICdJTlNFUlQgSU5UTyB1c2FnZSAocHJvdmlkZXIsIG1vZGVsLCBpbnB1dF90b2tlbnMsIG91dHB1dF90b2tlbnMsIGNvc3QpIFZBTFVFUyAoPywgPywgPywgPywgPyknXG4gICk7XG4gIHN0bXQucnVuKHByb3ZpZGVyLCBtb2RlbCwgaW5wdXRUb2tlbnMsIG91dHB1dFRva2VucywgY29zdCk7XG59XG5cbi8qKlxuICogR2V0IGRhc2hib2FyZCBzdGF0aXN0aWNzIChvcHRpb25hbGx5IHNjb3BlZCB0byB1c2VyKVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0U3RhdHModXNlcklkPzogc3RyaW5nIHwgbnVsbCkge1xuICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTtcbiAgY29uc3QgdG9kYXlTdGFydCA9IG5vdyAtIChub3cgJSA4NjQwMCk7XG5cbiAgLy8gU3RhcnQgb2YgY3VycmVudCBtb250aFxuICBjb25zdCBkYXRlID0gbmV3IERhdGUoKTtcbiAgY29uc3QgbW9udGhTdGFydCA9IE1hdGguZmxvb3IobmV3IERhdGUoZGF0ZS5nZXRGdWxsWWVhcigpLCBkYXRlLmdldE1vbnRoKCksIDEpLmdldFRpbWUoKSAvIDEwMDApO1xuXG4gIGNvbnN0IHVzZXJGaWx0ZXIgPSB1c2VySWQgPyAnQU5EIHVzZXJfaWQgPSA/JyA6ICcnO1xuICBjb25zdCB1c2VyUGFyYW1zID0gdXNlcklkID8gW3VzZXJJZF0gOiBbXTtcblxuICBjb25zdCBxdWVyaWVzVG9kYXkgPSBkYlxuICAgIC5wcmVwYXJlKGBTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBxdWVyaWVzIFdIRVJFIGNyZWF0ZWRfYXQgPj0gPyAke3VzZXJGaWx0ZXJ9YClcbiAgICAuZ2V0KC4uLih1c2VySWQgPyBbdG9kYXlTdGFydCwgdXNlcklkXSA6IFt0b2RheVN0YXJ0XSkpIGFzIGFueTtcblxuICBjb25zdCBxdWVyaWVzTW9udGggPSBkYlxuICAgIC5wcmVwYXJlKGBTRUxFQ1QgQ09VTlQoKikgYXMgY291bnQgRlJPTSBxdWVyaWVzIFdIRVJFIGNyZWF0ZWRfYXQgPj0gPyAke3VzZXJGaWx0ZXJ9YClcbiAgICAuZ2V0KC4uLih1c2VySWQgPyBbbW9udGhTdGFydCwgdXNlcklkXSA6IFttb250aFN0YXJ0XSkpIGFzIGFueTtcblxuICBjb25zdCB0b3RhbHMgPSBkYlxuICAgIC5wcmVwYXJlKGBTRUxFQ1QgU1VNKHRva2Vuc191c2VkKSBhcyB0b2tlbnMsIFNVTShjb3N0KSBhcyBjb3N0IEZST00gcXVlcmllcyAke3VzZXJJZCA/ICdXSEVSRSB1c2VyX2lkID0gPycgOiAnJ31gKVxuICAgIC5nZXQoLi4udXNlclBhcmFtcykgYXMgYW55O1xuXG4gIGNvbnN0IGF2Z1RpbWUgPSBkYlxuICAgIC5wcmVwYXJlKFxuICAgICAgYFNFTEVDVCBBVkcoY29tcGxldGVkX2F0IC0gY3JlYXRlZF9hdCkgYXMgYXZnIEZST00gcXVlcmllcyBXSEVSRSBzdGF0dXMgPSAnY29tcGxldGUnIEFORCBjb21wbGV0ZWRfYXQgSVMgTk9UIE5VTEwgJHt1c2VyRmlsdGVyfWBcbiAgICApXG4gICAgLmdldCguLi51c2VyUGFyYW1zKSBhcyBhbnk7XG5cbiAgY29uc3QgcHJvdmlkZXJTdGF0cyA9IGRiXG4gICAgLnByZXBhcmUoXG4gICAgICBgU0VMRUNUIHByb3ZpZGVyLCBDT1VOVCgqKSBhcyBxdWVyaWVzLCBTVU0oY29zdCkgYXMgY29zdFxuICAgICAgIEZST00gdXNhZ2VcbiAgICAgICBHUk9VUCBCWSBwcm92aWRlcmBcbiAgICApXG4gICAgLmFsbCgpIGFzIEFycmF5PHsgcHJvdmlkZXI6IHN0cmluZzsgcXVlcmllczogbnVtYmVyOyBjb3N0OiBudW1iZXIgfT47XG5cbiAgcmV0dXJuIHtcbiAgICBxdWVyaWVzVG9kYXk6IHF1ZXJpZXNUb2RheT8uY291bnQgfHwgMCxcbiAgICBxdWVyaWVzVGhpc01vbnRoOiBxdWVyaWVzTW9udGg/LmNvdW50IHx8IDAsXG4gICAgdG90YWxUb2tlbnM6IHRvdGFscz8udG9rZW5zIHx8IDAsXG4gICAgdG90YWxDb3N0OiB0b3RhbHM/LmNvc3QgfHwgMCxcbiAgICBhdmdSZXNwb25zZVRpbWU6IGF2Z1RpbWU/LmF2ZyB8fCAwLFxuICAgIHByb3ZpZGVyU3RhdHMsXG4gIH07XG59XG5cbi8qKlxuICogR2V0IHJlY2VudCBxdWVyaWVzIChvcHRpb25hbGx5IHNjb3BlZCB0byB1c2VyKVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UmVjZW50UXVlcmllcyhsaW1pdDogbnVtYmVyID0gMTAsIHVzZXJJZD86IHN0cmluZyB8IG51bGwpIHtcbiAgaWYgKHVzZXJJZCkge1xuICAgIGNvbnN0IHN0bXQgPSBkYi5wcmVwYXJlKGBcbiAgICAgIFNFTEVDVCBpZCwgcXVlcnksIGZsb3csIHN0YXR1cywgY3JlYXRlZF9hdCwgY29tcGxldGVkX2F0XG4gICAgICBGUk9NIHF1ZXJpZXNcbiAgICAgIFdIRVJFIHVzZXJfaWQgPSA/XG4gICAgICBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0NcbiAgICAgIExJTUlUID9cbiAgICBgKTtcbiAgICByZXR1cm4gc3RtdC5hbGwodXNlcklkLCBsaW1pdCkgYXMgQXJyYXk8e1xuICAgICAgaWQ6IHN0cmluZztcbiAgICAgIHF1ZXJ5OiBzdHJpbmc7XG4gICAgICBmbG93OiBzdHJpbmc7XG4gICAgICBzdGF0dXM6IHN0cmluZztcbiAgICAgIGNyZWF0ZWRfYXQ6IG51bWJlcjtcbiAgICAgIGNvbXBsZXRlZF9hdDogbnVtYmVyIHwgbnVsbDtcbiAgICB9PjtcbiAgfVxuICBjb25zdCBzdG10ID0gZGIucHJlcGFyZShgXG4gICAgU0VMRUNUIGlkLCBxdWVyeSwgZmxvdywgc3RhdHVzLCBjcmVhdGVkX2F0LCBjb21wbGV0ZWRfYXRcbiAgICBGUk9NIHF1ZXJpZXNcbiAgICBPUkRFUiBCWSBjcmVhdGVkX2F0IERFU0NcbiAgICBMSU1JVCA/XG4gIGApO1xuICByZXR1cm4gc3RtdC5hbGwobGltaXQpIGFzIEFycmF5PHtcbiAgICBpZDogc3RyaW5nO1xuICAgIHF1ZXJ5OiBzdHJpbmc7XG4gICAgZmxvdzogc3RyaW5nO1xuICAgIHN0YXR1czogc3RyaW5nO1xuICAgIGNyZWF0ZWRfYXQ6IG51bWJlcjtcbiAgICBjb21wbGV0ZWRfYXQ6IG51bWJlciB8IG51bGw7XG4gIH0+O1xufVxuXG4vKipcbiAqIENsb3NlIGRhdGFiYXNlIGNvbm5lY3Rpb24gKGZvciBncmFjZWZ1bCBzaHV0ZG93bilcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsb3NlRGF0YWJhc2UoKSB7XG4gIGRiLmNsb3NlKCk7XG4gIGNvbnNvbGUubG9nKCdEYXRhYmFzZSBjb25uZWN0aW9uIGNsb3NlZCcpO1xufVxuXG4vKipcbiAqIE1pZ3JhdGlvbjogQWRkIHVzZXJfaWQgY29sdW1ucyB0byBleGlzdGluZyB0YWJsZXMgaWYgdGhleSBkb24ndCBleGlzdFxuICogU1FMaXRlIGRvZXNuJ3Qgc3VwcG9ydCBBTFRFUiBUQUJMRSBBREQgQ09MVU1OIElGIE5PVCBFWElTVFMsIHNvIHdlIGNoZWNrIGZpcnN0XG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBtaWdyYXRlQWRkVXNlcklkQ29sdW1ucygpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnW0RFQlVHXSBTdGFydGluZyBtaWdyYXRpb246IG1pZ3JhdGVBZGRVc2VySWRDb2x1bW5zJyk7XG4gICAgLy8gQ2hlY2sgaWYgdXNlcl9pZCBjb2x1bW4gZXhpc3RzIGluIHF1ZXJpZXMgdGFibGVcbiAgICBjb25zdCBxdWVyaWVzSW5mbyA9IGRiLnByZXBhcmUoXCJQUkFHTUEgdGFibGVfaW5mbyhxdWVyaWVzKVwiKS5hbGwoKSBhcyBBcnJheTx7IG5hbWU6IHN0cmluZyB9PjtcbiAgICBjb25zdCBoYXNVc2VySWRJblF1ZXJpZXMgPSBxdWVyaWVzSW5mby5zb21lKGNvbCA9PiBjb2wubmFtZSA9PT0gJ3VzZXJfaWQnKTtcbiAgICBjb25zb2xlLmxvZygnW0RFQlVHXSBRdWVyaWVzIHRhYmxlIGNvbHVtbnM6JywgcXVlcmllc0luZm8ubWFwKGMgPT4gYy5uYW1lKSwgJ2hhc1VzZXJJZDonLCBoYXNVc2VySWRJblF1ZXJpZXMpO1xuICAgIFxuICAgIGlmICghaGFzVXNlcklkSW5RdWVyaWVzKSB7XG4gICAgICBjb25zb2xlLmxvZygnW0RFQlVHXSBBZGRpbmcgdXNlcl9pZCBjb2x1bW4gdG8gcXVlcmllcyB0YWJsZScpO1xuICAgICAgZGIuZXhlYygnQUxURVIgVEFCTEUgcXVlcmllcyBBREQgQ09MVU1OIHVzZXJfaWQgVEVYVCcpO1xuICAgICAgZGIuZXhlYygnQ1JFQVRFIElOREVYIElGIE5PVCBFWElTVFMgaWR4X3F1ZXJpZXNfdXNlcl9pZCBPTiBxdWVyaWVzKHVzZXJfaWQpJyk7XG4gICAgICBjb25zb2xlLmxvZygn4pyFIEFkZGVkIHVzZXJfaWQgY29sdW1uIHRvIHF1ZXJpZXMgdGFibGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coJ1tERUJVR10gdXNlcl9pZCBjb2x1bW4gYWxyZWFkeSBleGlzdHMgaW4gcXVlcmllcyB0YWJsZScpO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIHVzZXJfaWQgY29sdW1uIGV4aXN0cyBpbiB0b3BpY3MgdGFibGUgKHdpbGwgYmUgY3JlYXRlZCBpZiB0YWJsZSBkb2Vzbid0IGV4aXN0KVxuICAgIGNvbnN0IHRvcGljc0luZm8gPSBkYi5wcmVwYXJlKFwiUFJBR01BIHRhYmxlX2luZm8odG9waWNzKVwiKS5hbGwoKSBhcyBBcnJheTx7IG5hbWU6IHN0cmluZyB9PjtcbiAgICBjb25zdCBoYXNVc2VySWRJblRvcGljcyA9IHRvcGljc0luZm8uc29tZShjb2wgPT4gY29sLm5hbWUgPT09ICd1c2VyX2lkJyk7XG4gICAgXG4gICAgaWYgKHRvcGljc0luZm8ubGVuZ3RoID4gMCAmJiAhaGFzVXNlcklkSW5Ub3BpY3MpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbREVCVUddIEFkZGluZyB1c2VyX2lkIGNvbHVtbiB0byB0b3BpY3MgdGFibGUnKTtcbiAgICAgIGRiLmV4ZWMoJ0FMVEVSIFRBQkxFIHRvcGljcyBBREQgQ09MVU1OIHVzZXJfaWQgVEVYVCcpO1xuICAgICAgY29uc29sZS5sb2coJ+KchSBBZGRlZCB1c2VyX2lkIGNvbHVtbiB0byB0b3BpY3MgdGFibGUnKTtcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5sb2coJ1tERUJVR10gVG9waWNzIHRhYmxlIGNoZWNrIC0gdGFibGUgZXhpc3RzOicsIHRvcGljc0luZm8ubGVuZ3RoID4gMCwgJ2hhc1VzZXJJZDonLCB0b3BpY3NJbmZvLmxlbmd0aCA+IDAgPyBoYXNVc2VySWRJblRvcGljcyA6ICdOL0EgKHRhYmxlIGRvZXMgbm90IGV4aXN0KScpO1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zdCBlcnJvckluZm8gPSB7XG4gICAgICBtZXNzYWdlOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFN0cmluZyhlcnJvciksXG4gICAgICBuYW1lOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubmFtZSA6ICdVbmtub3duJyxcbiAgICAgIGNvZGU6IChlcnJvciBhcyBhbnkpPy5jb2RlIHx8ICdubyBjb2RlJyxcbiAgICAgIHN0YWNrOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3Iuc3RhY2s/LnN1YnN0cmluZygwLCAzMDApIDogJ25vIHN0YWNrJ1xuICAgIH07XG4gICAgY29uc29sZS5lcnJvcignW0RFQlVHXSBNaWdyYXRpb24gZXJyb3I6JywgZXJyb3JJbmZvKTtcbiAgICB0aHJvdyBlcnJvcjsgLy8gUmUtdGhyb3cgdG8gcHJldmVudCBzaWxlbnQgZmFpbHVyZXNcbiAgfVxufVxuXG4vLyBSdW4gbWlncmF0aW9uIG9uIG1vZHVsZSBsb2FkIChhZnRlciBzY2hlbWEgaW5pdGlhbGl6YXRpb24pXG50cnkge1xuICBjb25zb2xlLmxvZygnW0RFQlVHXSBSdW5uaW5nIG1pZ3JhdGlvbiBvbiBtb2R1bGUgbG9hZCcpO1xuICBtaWdyYXRlQWRkVXNlcklkQ29sdW1ucygpO1xuICBjb25zb2xlLmxvZygnW0RFQlVHXSBNaWdyYXRpb24gY29tcGxldGVkIHN1Y2Nlc3NmdWxseScpO1xufSBjYXRjaCAoZXJyb3IpIHtcbiAgY29uc29sZS5lcnJvcignW0RFQlVHXSBGYWlsZWQgdG8gcnVuIG1pZ3JhdGlvbiBvbiBtb2R1bGUgbG9hZDonLCBlcnJvcik7XG4gIC8vIERvbid0IHRocm93IC0gYWxsb3cgYXBwIHRvIHN0YXJ0IGJ1dCBsb2cgdGhlIGVycm9yXG59XG5cbi8qKlxuICogVXNlciBNYW5hZ2VtZW50IEZ1bmN0aW9uc1xuICovXG5cbmV4cG9ydCBpbnRlcmZhY2UgVXNlciB7XG4gIGlkOiBzdHJpbmc7XG4gIHVzZXJuYW1lOiBzdHJpbmcgfCBudWxsO1xuICBlbWFpbDogc3RyaW5nIHwgbnVsbDtcbiAgYXZhdGFyX3VybDogc3RyaW5nIHwgbnVsbDtcbiAgYXV0aF9wcm92aWRlcjogJ2dpdGh1YicgfCAnd2FsbGV0JztcbiAgYXV0aF9pZDogc3RyaW5nO1xuICBjcmVhdGVkX2F0OiBudW1iZXI7XG4gIHVwZGF0ZWRfYXQ6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBDcmVhdGUgb3IgZ2V0IHVzZXIgYnkgYXV0aCBwcm92aWRlciBhbmQgSURcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU9yR2V0VXNlcihcbiAgYXV0aFByb3ZpZGVyOiAnZ2l0aHViJyB8ICd3YWxsZXQnLFxuICBhdXRoSWQ6IHN0cmluZyxcbiAgdXNlckRhdGE/OiB7XG4gICAgdXNlcm5hbWU/OiBzdHJpbmc7XG4gICAgZW1haWw/OiBzdHJpbmc7XG4gICAgYXZhdGFyX3VybD86IHN0cmluZztcbiAgfVxuKTogVXNlciB7XG4gIC8vIENoZWNrIGlmIHVzZXIgZXhpc3RzXG4gIGNvbnN0IGV4aXN0aW5nID0gZGIucHJlcGFyZSgnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBhdXRoX3Byb3ZpZGVyID0gPyBBTkQgYXV0aF9pZCA9ID8nKS5nZXQoYXV0aFByb3ZpZGVyLCBhdXRoSWQpIGFzIFVzZXIgfCB1bmRlZmluZWQ7XG4gIFxuICBpZiAoZXhpc3RpbmcpIHtcbiAgICAvLyBVcGRhdGUgaWYgbmV3IGRhdGEgcHJvdmlkZWRcbiAgICBpZiAodXNlckRhdGEgJiYgKHVzZXJEYXRhLnVzZXJuYW1lIHx8IHVzZXJEYXRhLmVtYWlsIHx8IHVzZXJEYXRhLmF2YXRhcl91cmwpKSB7XG4gICAgICBjb25zdCB1cGRhdGVzOiBzdHJpbmdbXSA9IFtdO1xuICAgICAgY29uc3QgdmFsdWVzOiBhbnlbXSA9IFtdO1xuICAgICAgXG4gICAgICBpZiAodXNlckRhdGEudXNlcm5hbWUgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB1cGRhdGVzLnB1c2goJ3VzZXJuYW1lID0gPycpO1xuICAgICAgICB2YWx1ZXMucHVzaCh1c2VyRGF0YS51c2VybmFtZSk7XG4gICAgICB9XG4gICAgICBpZiAodXNlckRhdGEuZW1haWwgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB1cGRhdGVzLnB1c2goJ2VtYWlsID0gPycpO1xuICAgICAgICB2YWx1ZXMucHVzaCh1c2VyRGF0YS5lbWFpbCk7XG4gICAgICB9XG4gICAgICBpZiAodXNlckRhdGEuYXZhdGFyX3VybCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHVwZGF0ZXMucHVzaCgnYXZhdGFyX3VybCA9ID8nKTtcbiAgICAgICAgdmFsdWVzLnB1c2godXNlckRhdGEuYXZhdGFyX3VybCk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIGlmICh1cGRhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdXBkYXRlcy5wdXNoKCd1cGRhdGVkX2F0ID0gc3RyZnRpbWUoXFwnJXNcXCcsIFxcJ25vd1xcJyknKTtcbiAgICAgICAgdmFsdWVzLnB1c2goZXhpc3RpbmcuaWQpO1xuICAgICAgICBkYi5wcmVwYXJlKGBVUERBVEUgdXNlcnMgU0VUICR7dXBkYXRlcy5qb2luKCcsICcpfSBXSEVSRSBpZCA9ID9gKS5ydW4oLi4udmFsdWVzKTtcbiAgICAgICAgcmV0dXJuIGRiLnByZXBhcmUoJ1NFTEVDVCAqIEZST00gdXNlcnMgV0hFUkUgaWQgPSA/JykuZ2V0KGV4aXN0aW5nLmlkKSBhcyBVc2VyO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZXhpc3Rpbmc7XG4gIH1cbiAgXG4gIC8vIENyZWF0ZSBuZXcgdXNlclxuICBjb25zdCB1c2VySWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTUpO1xuICBkYi5wcmVwYXJlKGBcbiAgICBJTlNFUlQgSU5UTyB1c2VycyAoaWQsIHVzZXJuYW1lLCBlbWFpbCwgYXZhdGFyX3VybCwgYXV0aF9wcm92aWRlciwgYXV0aF9pZClcbiAgICBWQUxVRVMgKD8sID8sID8sID8sID8sID8pXG4gIGApLnJ1bihcbiAgICB1c2VySWQsXG4gICAgdXNlckRhdGE/LnVzZXJuYW1lIHx8IG51bGwsXG4gICAgdXNlckRhdGE/LmVtYWlsIHx8IG51bGwsXG4gICAgdXNlckRhdGE/LmF2YXRhcl91cmwgfHwgbnVsbCxcbiAgICBhdXRoUHJvdmlkZXIsXG4gICAgYXV0aElkXG4gICk7XG4gIFxuICByZXR1cm4gZGIucHJlcGFyZSgnU0VMRUNUICogRlJPTSB1c2VycyBXSEVSRSBpZCA9ID8nKS5nZXQodXNlcklkKSBhcyBVc2VyO1xufVxuXG4vKipcbiAqIEdldCB1c2VyIGJ5IElEXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBnZXRVc2VyKHVzZXJJZDogc3RyaW5nKTogVXNlciB8IHVuZGVmaW5lZCB7XG4gIHJldHVybiBkYi5wcmVwYXJlKCdTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGlkID0gPycpLmdldCh1c2VySWQpIGFzIFVzZXIgfCB1bmRlZmluZWQ7XG59XG5cbi8qKlxuICogR2V0IGFub255bW91cyB1c2VyIChmb3IgbWlncmF0aW9uKVxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0T3JDcmVhdGVBbm9ueW1vdXNVc2VyKCk6IFVzZXIge1xuICBjb25zdCBhbm9ueW1vdXMgPSBkYi5wcmVwYXJlKCdTRUxFQ1QgKiBGUk9NIHVzZXJzIFdIRVJFIGF1dGhfcHJvdmlkZXIgPSA/IEFORCBhdXRoX2lkID0gPycpLmdldCgnd2FsbGV0JywgJ2Fub255bW91cycpIGFzIFVzZXIgfCB1bmRlZmluZWQ7XG4gIFxuICBpZiAoYW5vbnltb3VzKSB7XG4gICAgcmV0dXJuIGFub255bW91cztcbiAgfVxuICBcbiAgcmV0dXJuIGNyZWF0ZU9yR2V0VXNlcignd2FsbGV0JywgJ2Fub255bW91cycsIHtcbiAgICB1c2VybmFtZTogJ0Fub255bW91cycsXG4gIH0pO1xufVxuXG4vKipcbiAqIFNlc3Npb24gTWFuYWdlbWVudCBGdW5jdGlvbnNcbiAqL1xuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb24ge1xuICBpZDogc3RyaW5nO1xuICB1c2VyX2lkOiBzdHJpbmc7XG4gIHRva2VuOiBzdHJpbmc7XG4gIGV4cGlyZXNfYXQ6IG51bWJlcjtcbiAgY3JlYXRlZF9hdDogbnVtYmVyO1xufVxuXG4vKipcbiAqIENyZWF0ZSBhIG5ldyBzZXNzaW9uXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVTZXNzaW9uKHVzZXJJZDogc3RyaW5nLCBleHBpcmVzSW5TZWNvbmRzOiBudW1iZXIgPSAzMCAqIDI0ICogNjAgKiA2MCk6IFNlc3Npb24ge1xuICBjb25zdCBzZXNzaW9uSWQgPSBNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgMTUpO1xuICBjb25zdCB0b2tlbiA9IE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMzYpLnN1YnN0cmluZygyLCAzMCkgKyBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KTtcbiAgY29uc3QgZXhwaXJlc0F0ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCkgKyBleHBpcmVzSW5TZWNvbmRzO1xuICBcbiAgZGIucHJlcGFyZShgXG4gICAgSU5TRVJUIElOVE8gc2Vzc2lvbnMgKGlkLCB1c2VyX2lkLCB0b2tlbiwgZXhwaXJlc19hdClcbiAgICBWQUxVRVMgKD8sID8sID8sID8pXG4gIGApLnJ1bihzZXNzaW9uSWQsIHVzZXJJZCwgdG9rZW4sIGV4cGlyZXNBdCk7XG4gIFxuICByZXR1cm4gZGIucHJlcGFyZSgnU0VMRUNUICogRlJPTSBzZXNzaW9ucyBXSEVSRSBpZCA9ID8nKS5nZXQoc2Vzc2lvbklkKSBhcyBTZXNzaW9uO1xufVxuXG4vKipcbiAqIFZhbGlkYXRlIHNlc3Npb24gdG9rZW4gYW5kIHJldHVybiB1c2VyXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZVNlc3Npb24odG9rZW46IHN0cmluZyk6IFVzZXIgfCBudWxsIHtcbiAgY29uc29sZS5sb2coJ1tERUJVR10gdmFsaWRhdGVTZXNzaW9uIGVudHJ5LCB0b2tlbjonLCB0b2tlbi5zdWJzdHJpbmcoMCwgMTApKTtcbiAgLy8gI3JlZ2lvbiBhZ2VudCBsb2dcbiAgdHJ5IHsgZmV0Y2goJ2h0dHA6Ly8xMjcuMC4wLjE6NzI0Mi9pbmdlc3QvM2E5NDI2OTgtYjhmMi00NDgyLTgyNGEtYWMwODJiYTg4MDM2Jyx7bWV0aG9kOidQT1NUJyxoZWFkZXJzOnsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24vanNvbid9LGJvZHk6SlNPTi5zdHJpbmdpZnkoe2xvY2F0aW9uOidsaWIvZGF0YWJhc2UudHM6NDkyJyxtZXNzYWdlOid2YWxpZGF0ZVNlc3Npb24gZW50cnknLGRhdGE6e3Rva2VuOnRva2VuLnN1YnN0cmluZygwLDEwKX0sdGltZXN0YW1wOkRhdGUubm93KCksc2Vzc2lvbklkOidkZWJ1Zy1zZXNzaW9uJyxydW5JZDoncnVuMScsaHlwb3RoZXNpc0lkOidCJ30pfSkuY2F0Y2goKCk9Pnt9KTsgfSBjYXRjaChlKSB7fVxuICAvLyAjZW5kcmVnaW9uXG4gIFxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCdbREVCVUddIEJlZm9yZSBTUUwgcXVlcnknKTtcbiAgICAvLyAjcmVnaW9uIGFnZW50IGxvZ1xuICAgIHRyeSB7IGZldGNoKCdodHRwOi8vMTI3LjAuMC4xOjcyNDIvaW5nZXN0LzNhOTQyNjk4LWI4ZjItNDQ4Mi04MjRhLWFjMDgyYmE4ODAzNicse21ldGhvZDonUE9TVCcsaGVhZGVyczp7J0NvbnRlbnQtVHlwZSc6J2FwcGxpY2F0aW9uL2pzb24nfSxib2R5OkpTT04uc3RyaW5naWZ5KHtsb2NhdGlvbjonbGliL2RhdGFiYXNlLnRzOjQ5NScsbWVzc2FnZTonQmVmb3JlIFNRTCBxdWVyeScsZGF0YTp7fSx0aW1lc3RhbXA6RGF0ZS5ub3coKSxzZXNzaW9uSWQ6J2RlYnVnLXNlc3Npb24nLHJ1bklkOidydW4xJyxoeXBvdGhlc2lzSWQ6J0QnfSl9KS5jYXRjaCgoKT0+e30pOyB9IGNhdGNoKGUpIHt9XG4gICAgLy8gI2VuZHJlZ2lvblxuICAgIFxuICAgIC8vIENoZWNrIGlmIHRhYmxlcyBleGlzdFxuICAgIGNvbnN0IHRhYmxlc0NoZWNrID0gZGIucHJlcGFyZShgXG4gICAgICBTRUxFQ1QgbmFtZSBGUk9NIHNxbGl0ZV9tYXN0ZXIgXG4gICAgICBXSEVSRSB0eXBlPSd0YWJsZScgQU5EIChuYW1lPSd1c2VycycgT1IgbmFtZT0nc2Vzc2lvbnMnKVxuICAgIGApLmFsbCgpIGFzIEFycmF5PHsgbmFtZTogc3RyaW5nIH0+O1xuICAgIGNvbnNvbGUubG9nKCdbREVCVUddIFRhYmxlcyBjaGVjazonLCB0YWJsZXNDaGVjay5tYXAodCA9PiB0Lm5hbWUpLCAnaGFzVXNlcnM6JywgISF0YWJsZXNDaGVjay5maW5kKHQgPT4gdC5uYW1lID09PSAndXNlcnMnKSwgJ2hhc1Nlc3Npb25zOicsICEhdGFibGVzQ2hlY2suZmluZCh0ID0+IHQubmFtZSA9PT0gJ3Nlc3Npb25zJykpO1xuICAgIC8vICNyZWdpb24gYWdlbnQgbG9nXG4gICAgdHJ5IHsgZmV0Y2goJ2h0dHA6Ly8xMjcuMC4wLjE6NzI0Mi9pbmdlc3QvM2E5NDI2OTgtYjhmMi00NDgyLTgyNGEtYWMwODJiYTg4MDM2Jyx7bWV0aG9kOidQT1NUJyxoZWFkZXJzOnsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24vanNvbid9LGJvZHk6SlNPTi5zdHJpbmdpZnkoe2xvY2F0aW9uOidsaWIvZGF0YWJhc2UudHM6NTAyJyxtZXNzYWdlOidUYWJsZXMgY2hlY2snLGRhdGE6e3RhYmxlc0ZvdW5kOnRhYmxlc0NoZWNrLm1hcCh0PT50Lm5hbWUpLGhhc1VzZXJzOiEhdGFibGVzQ2hlY2suZmluZCh0PT50Lm5hbWU9PT0ndXNlcnMnKSxoYXNTZXNzaW9uczohIXRhYmxlc0NoZWNrLmZpbmQodD0+dC5uYW1lPT09J3Nlc3Npb25zJyl9LHRpbWVzdGFtcDpEYXRlLm5vdygpLHNlc3Npb25JZDonZGVidWctc2Vzc2lvbicscnVuSWQ6J3J1bjEnLGh5cG90aGVzaXNJZDonQyd9KX0pLmNhdGNoKCgpPT57fSk7IH0gY2F0Y2goZSkge31cbiAgICAvLyAjZW5kcmVnaW9uXG4gICAgXG4gICAgY29uc29sZS5sb2coJ1tERUJVR10gRXhlY3V0aW5nIFNRTCBxdWVyeSB3aXRoIHRva2VuJyk7XG4gICAgbGV0IHNlc3Npb247XG4gICAgdHJ5IHtcbiAgICAgIHNlc3Npb24gPSBkYi5wcmVwYXJlKGBcbiAgICAgICAgU0VMRUNUIHMuaWQgYXMgc2Vzc2lvbl9pZCwgcy51c2VyX2lkLCBzLnRva2VuLCBzLmV4cGlyZXNfYXQsIHMuY3JlYXRlZF9hdCBhcyBzZXNzaW9uX2NyZWF0ZWRfYXQsXG4gICAgICAgICAgICAgICB1LmlkLCB1LnVzZXJuYW1lLCB1LmVtYWlsLCB1LmF2YXRhcl91cmwsIHUuYXV0aF9wcm92aWRlciwgdS5hdXRoX2lkLCB1LmNyZWF0ZWRfYXQsIHUudXBkYXRlZF9hdFxuICAgICAgICBGUk9NIHNlc3Npb25zIHNcbiAgICAgICAgSk9JTiB1c2VycyB1IE9OIHMudXNlcl9pZCA9IHUuaWRcbiAgICAgICAgV0hFUkUgcy50b2tlbiA9ID8gQU5EIHMuZXhwaXJlc19hdCA+IHN0cmZ0aW1lKCclcycsICdub3cnKVxuICAgICAgYCkuZ2V0KHRva2VuKSBhcyB7XG4gICAgICBzZXNzaW9uX2lkOiBzdHJpbmc7XG4gICAgICB1c2VyX2lkOiBzdHJpbmc7XG4gICAgICB0b2tlbjogc3RyaW5nO1xuICAgICAgZXhwaXJlc19hdDogbnVtYmVyO1xuICAgICAgc2Vzc2lvbl9jcmVhdGVkX2F0OiBudW1iZXI7XG4gICAgICBpZDogc3RyaW5nO1xuICAgICAgdXNlcm5hbWU6IHN0cmluZyB8IG51bGw7XG4gICAgICBlbWFpbDogc3RyaW5nIHwgbnVsbDtcbiAgICAgIGF2YXRhcl91cmw6IHN0cmluZyB8IG51bGw7XG4gICAgICBhdXRoX3Byb3ZpZGVyOiAnZ2l0aHViJyB8ICd3YWxsZXQnO1xuICAgICAgYXV0aF9pZDogc3RyaW5nO1xuICAgICAgY3JlYXRlZF9hdDogbnVtYmVyO1xuICAgICAgdXBkYXRlZF9hdDogbnVtYmVyO1xuICAgIH0gfCB1bmRlZmluZWQ7XG4gICAgfSBjYXRjaCAoc3FsRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ1tERUJVR10gU1FMIHF1ZXJ5IGVycm9yOicsIHNxbEVycm9yKTtcbiAgICAgIHRocm93IHNxbEVycm9yO1xuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZygnW0RFQlVHXSBBZnRlciBTUUwgcXVlcnksIGhhc1Nlc3Npb246JywgISFzZXNzaW9uLCAndXNlcklkOicsIHNlc3Npb24/LmlkIHx8IG51bGwpO1xuICAgIC8vICNyZWdpb24gYWdlbnQgbG9nXG4gICAgdHJ5IHsgZmV0Y2goJ2h0dHA6Ly8xMjcuMC4wLjE6NzI0Mi9pbmdlc3QvM2E5NDI2OTgtYjhmMi00NDgyLTgyNGEtYWMwODJiYTg4MDM2Jyx7bWV0aG9kOidQT1NUJyxoZWFkZXJzOnsnQ29udGVudC1UeXBlJzonYXBwbGljYXRpb24vanNvbid9LGJvZHk6SlNPTi5zdHJpbmdpZnkoe2xvY2F0aW9uOidsaWIvZGF0YWJhc2UudHM6NTIwJyxtZXNzYWdlOidBZnRlciBTUUwgcXVlcnknLGRhdGE6e2hhc1Nlc3Npb246ISFzZXNzaW9uLHVzZXJJZDpzZXNzaW9uPy5pZHx8bnVsbH0sdGltZXN0YW1wOkRhdGUubm93KCksc2Vzc2lvbklkOidkZWJ1Zy1zZXNzaW9uJyxydW5JZDoncnVuMScsaHlwb3RoZXNpc0lkOidCJ30pfSkuY2F0Y2goKCk9Pnt9KTsgfSBjYXRjaChlKSB7fVxuICAgIC8vICNlbmRyZWdpb25cbiAgICBcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICBcbiAgICByZXR1cm4ge1xuICAgICAgaWQ6IHNlc3Npb24uaWQsXG4gICAgICB1c2VybmFtZTogc2Vzc2lvbi51c2VybmFtZSxcbiAgICAgIGVtYWlsOiBzZXNzaW9uLmVtYWlsLFxuICAgICAgYXZhdGFyX3VybDogc2Vzc2lvbi5hdmF0YXJfdXJsLFxuICAgICAgYXV0aF9wcm92aWRlcjogc2Vzc2lvbi5hdXRoX3Byb3ZpZGVyLFxuICAgICAgYXV0aF9pZDogc2Vzc2lvbi5hdXRoX2lkLFxuICAgICAgY3JlYXRlZF9hdDogc2Vzc2lvbi5jcmVhdGVkX2F0LFxuICAgICAgdXBkYXRlZF9hdDogc2Vzc2lvbi51cGRhdGVkX2F0LFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc3QgZXJyb3JJbmZvID0ge1xuICAgICAgbWVzc2FnZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiBTdHJpbmcoZXJyb3IpLFxuICAgICAgbmFtZTogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm5hbWUgOiAnVW5rbm93bicsXG4gICAgICBjb2RlOiAoZXJyb3IgYXMgYW55KT8uY29kZSB8fCAnbm8gY29kZScsXG4gICAgICBzdGFjazogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLnN0YWNrPy5zdWJzdHJpbmcoMCwgMzAwKSA6ICdubyBzdGFjaydcbiAgICB9O1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tERUJVR10gdmFsaWRhdGVTZXNzaW9uIGVycm9yOicsIGVycm9ySW5mbyk7XG4gICAgLy8gI3JlZ2lvbiBhZ2VudCBsb2dcbiAgICB0cnkgeyBmZXRjaCgnaHR0cDovLzEyNy4wLjAuMTo3MjQyL2luZ2VzdC8zYTk0MjY5OC1iOGYyLTQ0ODItODI0YS1hYzA4MmJhODgwMzYnLHttZXRob2Q6J1BPU1QnLGhlYWRlcnM6eydDb250ZW50LVR5cGUnOidhcHBsaWNhdGlvbi9qc29uJ30sYm9keTpKU09OLnN0cmluZ2lmeSh7bG9jYXRpb246J2xpYi9kYXRhYmFzZS50czo1NDAnLG1lc3NhZ2U6J3ZhbGlkYXRlU2Vzc2lvbiBlcnJvcicsZGF0YTplcnJvckluZm8sdGltZXN0YW1wOkRhdGUubm93KCksc2Vzc2lvbklkOidkZWJ1Zy1zZXNzaW9uJyxydW5JZDoncnVuMScsaHlwb3RoZXNpc0lkOidDJ30pfSkuY2F0Y2goKCk9Pnt9KTsgfSBjYXRjaChlKSB7fVxuICAgIC8vICNlbmRyZWdpb25cbiAgICB0aHJvdyBlcnJvcjtcbiAgfVxufVxuXG4vKipcbiAqIERlc3Ryb3kgc2Vzc2lvbiAobG9nb3V0KVxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVzdHJveVNlc3Npb24odG9rZW46IHN0cmluZyk6IHZvaWQge1xuICBkYi5wcmVwYXJlKCdERUxFVEUgRlJPTSBzZXNzaW9ucyBXSEVSRSB0b2tlbiA9ID8nKS5ydW4odG9rZW4pO1xufVxuXG4vKipcbiAqIENsZWFuIGV4cGlyZWQgc2Vzc2lvbnNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuRXhwaXJlZFNlc3Npb25zKCk6IHZvaWQge1xuICBkYi5wcmVwYXJlKCdERUxFVEUgRlJPTSBzZXNzaW9ucyBXSEVSRSBleHBpcmVzX2F0IDw9IHN0cmZ0aW1lKFxcJyVzXFwnLCBcXCdub3dcXCcpJykucnVuKCk7XG59XG4iXSwibmFtZXMiOlsiRGF0YWJhc2UiLCJwYXRoIiwiZnMiLCJkYXRhRGlyIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwiZGJQYXRoIiwiZGIiLCJwcmFnbWEiLCJleGVjIiwiY29uc29sZSIsImxvZyIsImNyZWF0ZVF1ZXJ5IiwiaWQiLCJxdWVyeSIsImZsb3ciLCJ1c2VySWQiLCJzdG10IiwicHJlcGFyZSIsInJ1biIsInVwZGF0ZVF1ZXJ5IiwidXBkYXRlcyIsImZpZWxkcyIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJzZXRzIiwibWFwIiwiZiIsInZhbHVlcyIsImdldFF1ZXJ5IiwiZ2V0IiwiYWRkRXZlbnQiLCJxdWVyeUlkIiwidHlwZSIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwiZ2V0RXZlbnRzIiwib2Zmc2V0IiwiYWxsIiwidHJhY2tVc2FnZSIsInByb3ZpZGVyIiwibW9kZWwiLCJpbnB1dFRva2VucyIsIm91dHB1dFRva2VucyIsImNvc3QiLCJnZXRTdGF0cyIsIm5vdyIsIk1hdGgiLCJmbG9vciIsIkRhdGUiLCJ0b2RheVN0YXJ0IiwiZGF0ZSIsIm1vbnRoU3RhcnQiLCJnZXRGdWxsWWVhciIsImdldE1vbnRoIiwiZ2V0VGltZSIsInVzZXJGaWx0ZXIiLCJ1c2VyUGFyYW1zIiwicXVlcmllc1RvZGF5IiwicXVlcmllc01vbnRoIiwidG90YWxzIiwiYXZnVGltZSIsInByb3ZpZGVyU3RhdHMiLCJjb3VudCIsInF1ZXJpZXNUaGlzTW9udGgiLCJ0b3RhbFRva2VucyIsInRva2VucyIsInRvdGFsQ29zdCIsImF2Z1Jlc3BvbnNlVGltZSIsImF2ZyIsImdldFJlY2VudFF1ZXJpZXMiLCJsaW1pdCIsImNsb3NlRGF0YWJhc2UiLCJjbG9zZSIsIm1pZ3JhdGVBZGRVc2VySWRDb2x1bW5zIiwicXVlcmllc0luZm8iLCJoYXNVc2VySWRJblF1ZXJpZXMiLCJzb21lIiwiY29sIiwibmFtZSIsImMiLCJ0b3BpY3NJbmZvIiwiaGFzVXNlcklkSW5Ub3BpY3MiLCJlcnJvciIsImVycm9ySW5mbyIsIm1lc3NhZ2UiLCJFcnJvciIsIlN0cmluZyIsImNvZGUiLCJzdGFjayIsInN1YnN0cmluZyIsImNyZWF0ZU9yR2V0VXNlciIsImF1dGhQcm92aWRlciIsImF1dGhJZCIsInVzZXJEYXRhIiwiZXhpc3RpbmciLCJ1c2VybmFtZSIsImVtYWlsIiwiYXZhdGFyX3VybCIsInVuZGVmaW5lZCIsInB1c2giLCJyYW5kb20iLCJ0b1N0cmluZyIsImdldFVzZXIiLCJnZXRPckNyZWF0ZUFub255bW91c1VzZXIiLCJhbm9ueW1vdXMiLCJjcmVhdGVTZXNzaW9uIiwiZXhwaXJlc0luU2Vjb25kcyIsInNlc3Npb25JZCIsInRva2VuIiwiZXhwaXJlc0F0IiwidmFsaWRhdGVTZXNzaW9uIiwiZmV0Y2giLCJtZXRob2QiLCJoZWFkZXJzIiwiYm9keSIsImxvY2F0aW9uIiwidGltZXN0YW1wIiwicnVuSWQiLCJoeXBvdGhlc2lzSWQiLCJjYXRjaCIsImUiLCJ0YWJsZXNDaGVjayIsInQiLCJmaW5kIiwidGFibGVzRm91bmQiLCJoYXNVc2VycyIsImhhc1Nlc3Npb25zIiwic2Vzc2lvbiIsInNxbEVycm9yIiwiaGFzU2Vzc2lvbiIsImF1dGhfcHJvdmlkZXIiLCJhdXRoX2lkIiwiY3JlYXRlZF9hdCIsInVwZGF0ZWRfYXQiLCJkZXN0cm95U2Vzc2lvbiIsImNsZWFuRXhwaXJlZFNlc3Npb25zIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/database.ts\n");

/***/ }),

/***/ "(ssr)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!***********************************************************************************************************************************************************************!*\
  !*** ../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \***********************************************************************************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/server/app-render/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/action-async-storage.external.js");

/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "better-sqlite3":
/*!*********************************!*\
  !*** external "better-sqlite3" ***!
  \*********************************/
/***/ ((module) => {

"use strict";
module.exports = require("better-sqlite3");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "next/dist/shared/lib/no-fallback-error.external":
/*!******************************************************************!*\
  !*** external "next/dist/shared/lib/no-fallback-error.external" ***!
  \******************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/no-fallback-error.external");

/***/ }),

/***/ "next/dist/shared/lib/router/utils/app-paths":
/*!**************************************************************!*\
  !*** external "next/dist/shared/lib/router/utils/app-paths" ***!
  \**************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/shared/lib/router/utils/app-paths");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next@15.5.9_react-dom@19.2.3_react@19.2.3","vendor-chunks/@opentelemetry"], () => (__webpack_exec__("(rsc)/../../node_modules/.pnpm/next@15.5.9_react-dom@19.2.3_react@19.2.3/node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fstats%2Froute&page=%2Fapi%2Fstats%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fstats%2Froute.ts&appDir=%2FUsers%2Fsheirraza%2Fakhai%2Fpackages%2Fweb%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fsheirraza%2Fakhai%2Fpackages%2Fweb&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D&isGlobalNotFoundEnabled=!")));
module.exports = __webpack_exports__;

})();